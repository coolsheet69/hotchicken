<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hot Chicken Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1f2770 0%, #2a1545 100%);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Only hide cursor on desktop with precise pointing devices */
        @media (pointer: fine) {
            body {
                cursor: none;
            }
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            position: relative;
        }

        .chicken-area {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 500px;
            padding-top: 0px;
            position: relative;
            z-index: 99998;
        }

        .chicken {
            width: 260px;
            height: 390px;
            position: relative;
            transition: transform 0.2s ease-out, filter 0.1s ease;
            transform-origin: center center;
            user-select: none;
            -webkit-user-select: none;
            z-index: 99999;
        }

        .chicken.dodging {
            transition: transform 0.15s ease-out;
        }

        .chicken.grabbed {
            transform: scale(0.88, 1.12) rotate(-2deg) !important;
            filter: brightness(1.2);
        }

        .chicken.grabbed .neck-squeeze {
            transform: scaleX(0.3) scaleY(1.4);
        }

        .chicken.grabbed .head-squeeze {
            transform: scale(1.08);
            transform-origin: 150px 100px;
            animation: head-shake 0.1s ease-in-out infinite;
        }

        .chicken.grabbed .eye-squeeze {
            transform: scale(1.3);
        }

        .chicken.grabbed .pupil-left {
            animation: grab-eye-left 0.08s ease-in-out infinite;
        }

        .chicken.grabbed .pupil-right {
            animation: grab-eye-right 0.08s ease-in-out infinite;
        }

        @keyframes grab-eye-left {
            0%, 100% { transform: translateX(-8px); }
            50% { transform: translateX(8px); }
        }

        @keyframes grab-eye-right {
            0%, 100% { transform: translateX(8px); }
            50% { transform: translateX(-8px); }
        }

        @keyframes head-shake {
            0% { transform: scale(1.08) rotate(-8deg) translateX(-3px); }
            25% { transform: scale(1.08) rotate(8deg) translateX(3px); }
            50% { transform: scale(1.08) rotate(-8deg) translateX(-3px); }
            75% { transform: scale(1.08) rotate(8deg) translateX(3px); }
            100% { transform: scale(1.08) rotate(-8deg) translateX(-3px); }
        }

        /* Hot Zone Effects */
        .chicken.hotzone {
            filter: hue-rotate(-30deg) saturate(1.8) brightness(1.2) drop-shadow(0 0 20px rgba(231, 76, 60, 0.8));
        }

        .chicken.hotzone .pupil-left,
        .chicken.hotzone .pupil-right {
            animation-duration: 0.5s !important; /* 4x faster (was 2s) */
        }

        .hotzone-smoke {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            height: 410px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .hotzone-smoke.active {
            opacity: 1;
        }

        .smoke-particle {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(255, 100, 100, 0.3) 0%, rgba(255, 150, 0, 0.1) 50%, transparent 100%);
            border-radius: 50%;
            animation: smoke-rise 3s ease-in-out infinite;
        }

        .smoke-particle:nth-child(1) {
            left: 20%;
            animation-delay: 0s;
        }

        .smoke-particle:nth-child(2) {
            left: 50%;
            animation-delay: 1s;
        }

        .smoke-particle:nth-child(3) {
            left: 70%;
            animation-delay: 2s;
        }

        @keyframes smoke-rise {
            0% {
                bottom: 0;
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 0.6;
                transform: scale(1);
            }
            100% {
                bottom: 100%;
                opacity: 0;
                transform: scale(1.5);
            }
        }

        /* Hotzone Floating Messages */
        .hotzone-message {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            z-index: 100;
            animation: hotzone-float 1.5s ease-in-out infinite;
        }

        .hotzone-message.active {
            display: flex;
        }

        .hotzone-left {
            left: calc(50% - 280px);
        }

        .hotzone-right {
            right: calc(50% - 280px);
        }

        .hotzone-text {
            font-size: 22px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 20px rgba(255, 100, 0, 0.8);
            animation: hotzone-flash 0.15s linear infinite;
        }

        .hotzone-bonus {
            font-size: 14px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5), 0 0 10px rgba(255, 215, 0, 0.8);
            animation: hotzone-flash-bonus 0.2s linear infinite;
        }

        @keyframes hotzone-flash {
            0%, 50% {
                color: #FF0000;
            }
            51%, 100% {
                color: #FFD700;
            }
        }

        @keyframes hotzone-flash-bonus {
            0%, 50% {
                color: #FFD700;
                text-shadow: 1px 1px 3px rgba(0,0,0,0.5), 0 0 15px rgba(255, 215, 0, 1);
            }
            51%, 100% {
                color: #FF6600;
                text-shadow: 1px 1px 3px rgba(0,0,0,0.5), 0 0 15px rgba(255, 100, 0, 1);
            }
        }

        @keyframes hotzone-float {
            0%, 100% {
                transform: translateY(-50%) translateX(0);
            }
            50% {
                transform: translateY(-55%) translateX(3px);
            }
        }

        .chicken.wiggle {
            animation: wiggle 0.3s ease;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg) scale(0.9, 1.1); }
            75% { transform: rotate(5deg) scale(0.9, 1.1); }
        }

        /* Spinning eyeball animation - pupils orbit around eye center */
        @keyframes spin-left {
            0% { transform: translate(0px, -5px); }
            25% { transform: translate(5px, 0px); }
            50% { transform: translate(0px, 5px); }
            75% { transform: translate(-5px, 0px); }
            100% { transform: translate(0px, -5px); }
        }

        @keyframes spin-right {
            0% { transform: translate(0px, -5px); }
            25% { transform: translate(-5px, 0px); }
            50% { transform: translate(0px, 5px); }
            75% { transform: translate(5px, 0px); }
            100% { transform: translate(0px, -5px); }
        }

        .pupil-left {
            animation: spin-left 2s linear infinite;
        }

        .pupil-right {
            animation: spin-right 1.7s linear infinite;
        }

        /* Chicken SVG Illustration */
        .chicken-body {
            width: 100%;
            height: 100%;
        }

        /* Neck squeeze animation */
        .neck-squeeze {
            transition: transform 0.15s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform-origin: center;
        }

        /* Head and eye squeeze animations */
        .head-squeeze {
            transition: transform 0.05s ease-out;
            transform-origin: 150px 100px;
        }

        .eye-squeeze {
            transition: transform 0.15s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform-origin: center;
        }

        /* Custom cursor hand */
        .hand-cursor {
            position: fixed;
            width: 30px;
            height: 30px;
            pointer-events: none;
            z-index: 999999;
            transform: translate(-50%, -50%);
            transition: transform 0.08s ease-out;
            will-change: transform;
        }

        .hand-cursor.grabbing {
            animation: grab 0.2s ease;
        }

        @keyframes grab {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.15); }
            100% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .hand-cursor svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        /* Stats area */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 50px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .grab-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 50px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Grab Button */
        .grab-button-container {
            text-align: center;
            margin-top: -110px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            position: relative;
            z-index: 100000;
        }

        .amount-input-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .amount-input {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 3px 10px;
            font-size: 16px;
            color: white;
            text-align: center;
            width: 140px;
            font-weight: bold;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            line-height: 1.2;
            transition: all 0.3s ease;
        }

        .amount-input.below-minimum {
            color: #E74C3C;
            border-color: #E74C3C;
            background: rgba(231, 76, 60, 0.15);
        }

        .amount-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .amount-input.below-minimum::placeholder {
            color: rgba(231, 76, 60, 0.8);
        }

        .amount-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .amount-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .amount-min-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 10px;
            margin-left: 4px;
            white-space: nowrap;
        }

        .grab-button {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            color: white;
            font-size: 16px;
            font-weight: bold;
            padding: 10px 30px;
            border: 2px solid #000000;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .grab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.6);
        }

        .grab-button:active {
            transform: translateY(-1px);
        }

        .grab-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Leaderboard */
        .leaderboard-container {
            margin-top: 5px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            max-width: 576px;
            margin-left: auto;
            margin-right: auto;
        }

        .leaderboard-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-align: center;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .current-holder {
            background: rgba(255, 255, 255, 0.08);
            padding: 5px 10px;
            border-radius: 8px;
            margin-bottom: 4px;
            border: 2px solid #F39C12;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.6), 0 0 30px rgba(243, 156, 18, 0.3), inset 0 0 10px rgba(243, 156, 18, 0.1);
            display: grid;
            grid-template-columns: 60px 1fr 90px 90px;
            align-items: center;
            gap: 6px;
        }

        .current-holder-label {
            font-size: 13px;
            color: #F39C12;
            text-transform: uppercase;
            letter-spacing: 1px;
            grid-column: 1;
            font-weight: bold;
        }

        .current-holder-address {
            font-size: 15px;
            font-weight: bold;
            color: white;
            font-family: 'Courier New', monospace;
            text-align: left;
            grid-column: 2;
            padding-left: 1em;
        }

        .current-holder-amount {
            font-size: 17px;
            font-weight: bold;
            color: #F39C12;
            display: flex;
            align-items: center;
            gap: 2px;
            justify-content: flex-end;
            grid-column: 3;
        }

        .current-holder-amount .eshare-symbol {
            width: 20px;
            height: 20px;
        }

        .current-holder-winnings {
            font-size: 17px;
            font-weight: bold;
            color: #2ECC71;
            display: flex;
            align-items: center;
            gap: 2px;
            justify-content: flex-end;
            grid-column: 4;
        }

        .current-holder-winnings .eshare-symbol {
            width: 20px;
            height: 20px;
        }

        .eshare-symbol {
            width: 22px;
            height: 22px;
            vertical-align: middle;
            margin-left: 3px;
            display: inline-block;
        }

        .previous-holders {
            max-height: 180px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Custom scrollbar styling */
        .previous-holders::-webkit-scrollbar {
            width: 6px;
        }

        .previous-holders::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .previous-holders::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .previous-holders::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .previous-holders-wrapper {
            position: relative;
        }

        /* Scroll indicator */
        .scroll-indicator {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            color: white;
            padding: 5px 14px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 10;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .scroll-indicator.show {
            opacity: 0.85;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(5px); }
        }

        .holder-item.user-connected {
            background: rgba(52, 152, 219, 0.15);
            border: 1px solid rgba(52, 152, 219, 0.4);
        }

        .holder-item.user-connected:hover {
            background: rgba(52, 152, 219, 0.25);
        }

        .holder-item.user-connected .holder-address {
            color: #3498DB;
            font-weight: bold;
        }

        .previous-holders-label {
            display: none;
        }

        /* Column Headers */
        .leaderboard-column-headers {
            display: grid;
            grid-template-columns: 60px 1fr 90px 90px;
            gap: 6px;
            padding: 4px 10px;
            margin-bottom: 2px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .leaderboard-column-headers span {
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .header-rank {
            text-align: left;
        }

        .header-address {
            text-align: left;
        }

        .header-deposits {
            text-align: right;
        }

        .header-winnings {
            text-align: right;
        }

        .holder-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 3px 10px;
            border-radius: 6px;
            margin-bottom: 2px;
            display: grid;
            grid-template-columns: 60px 1fr 90px 90px;
            align-items: center;
            transition: background 0.2s ease;
            gap: 6px;
        }

        .holder-item:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .holder-rank {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            font-weight: bold;
            text-align: left;
        }

        .holder-address {
            font-family: 'Courier New', monospace;
            color: white;
            font-size: 15px;
            text-align: left;
            padding-left: 1em;
        }

        .holder-amount {
            color: #F39C12;
            font-size: 17px;
            font-weight: bold;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 2px;
            justify-content: flex-end;
        }

        .holder-amount .eshare-symbol {
            width: 20px;
            height: 20px;
        }

        .holder-winnings {
            color: #2ECC71;
            font-size: 17px;
            font-weight: bold;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 2px;
            justify-content: flex-end;
        }

        .holder-winnings .eshare-symbol {
            width: 20px;
            height: 20px;
        }

        .holder-time {
            color: rgba(255, 255, 255, 0.5);
            font-size: 11px;
            white-space: nowrap;
            text-align: right;
        }

        .connect-wallet {
            background: linear-gradient(135deg, #3498DB 0%, #2874A6 100%);
            color: white;
            font-size: 15px;
            font-weight: bold;
            padding: 10px 25px;
            border: 2px solid #000000;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
            transition: all 0.3s ease;
        }

        .connect-wallet:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.6);
        }

        /* Transform connect wallet button into grab button */
        .connect-wallet.is-grab-button {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            font-size: 16px;
            padding: 10px 30px;
            box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .connect-wallet.is-grab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.6);
        }

        /* Balance Display */
        .balance-container {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            margin-bottom: 5px;
        }

        .balance-label {
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: bold;
            color: #F39C12;
        }

        .balance-value {
            font-family: 'Courier New', monospace;
            color: #F39C12;
            font-weight: bold;
            font-size: 16px;
        }

        /* Connected Wallet Display */
        .connected-wallet {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 5px;
            margin-bottom: 3px;
        }

        /* Connected Wallet at Top */
        .connected-wallet-top {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            padding: 6px 12px;
            background: rgba(52, 152, 219, 0.15);
            border-radius: 8px;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        /* Previous Winners Container */
        .previous-winners-container {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            max-width: 576px;
            margin: 15px auto;
            backdrop-filter: blur(10px);
        }

        .previous-winners-title {
            color: #F39C12;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .previous-winners-list {
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .winner-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .winner-item.lotto-winner {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.3) 0%, rgba(39, 174, 96, 0.3) 100%);
            border: 2px solid rgba(46, 204, 113, 0.5);
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.3);
        }

        .winner-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .winner-round {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            font-weight: bold;
        }

        .winner-address {
            font-family: 'Courier New', monospace;
            color: white;
            font-size: 14px;
        }

        .winner-amount {
            color: #2ECC71;
            font-size: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .winner-amount .eshare-symbol {
            width: 18px;
            height: 18px;
        }

        .lotto-badge {
            background: linear-gradient(135deg, #2ECC71 0%, #27AE60 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Actions Box (below leaderboard) */
        .actions-box {
            margin: 2px auto 4px;
            padding: 2px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            max-width: 576px;
        }

        .action-box-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3px 10px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s ease;
            cursor: pointer !important;
            gap: 8px;
        }

        .action-box-btn:hover {
            transform: translateY(-3px);
        }

        .buy-btn {
            background: linear-gradient(135deg, #27AE60 0%, #229954 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 3px 6px; /* Narrower horizontal padding */
        }

        .buy-btn:hover {
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.5);
        }

        .action-box-logo {
            width: 24px;
            height: 24px;
        }

        .whitepaper-btn, .telegram-btn {
            background: transparent;
            padding: 3px;
            border: none;
        }

        .whitepaper-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.3);
        }

        .telegram-btn:hover {
            background: rgba(41, 171, 226, 0.15);
            box-shadow: 0 6px 20px rgba(41, 171, 226, 0.4);
        }

        .seed-btn {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 3px 8px;
            font-size: 16px;
            min-width: 32px;
        }

        .seed-btn:hover {
            box-shadow: 0 6px 20px rgba(155, 89, 182, 0.5);
        }

        /* Custom tooltips that appear above */
        .action-box-btn[data-tooltip] {
            position: relative;
        }

        .action-box-btn[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            margin-bottom: 8px;
            z-index: 10000;
        }

        .action-box-btn[data-tooltip]:hover::after {
            opacity: 1;
        }

        /* Seed Modal */
        .seed-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100010;
            justify-content: center;
            align-items: center;
        }

        .seed-modal-overlay.show {
            display: flex;
        }

        .seed-modal {
            background: linear-gradient(135deg, #2C3E50 0%, #1a252f 100%);
            border-radius: 15px;
            border: 2px solid rgba(155, 89, 182, 0.5);
            box-shadow: 0 0 30px rgba(155, 89, 182, 0.4);
            max-width: 320px;
            width: 90%;
            overflow: hidden;
        }

        .seed-modal-header {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .seed-modal-body {
            padding: 15px;
        }

        .seed-modal-desc {
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            margin: 0 0 15px 0;
            font-size: 13px;
        }

        .seed-modal-input-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .seed-modal-input {
            width: 100px;
            padding: 8px 12px;
            border-radius: 8px;
            border: 2px solid rgba(155, 89, 182, 0.5);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 16px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .seed-modal-input:focus {
            outline: none;
            border-color: #9B59B6;
        }

        .seed-modal-label {
            color: #9B59B6;
            font-weight: bold;
            font-size: 14px;
        }

        .seed-modal-buttons {
            display: flex;
            gap: 10px;
            padding: 0 15px 15px;
        }

        .seed-modal-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .seed-modal-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .seed-modal-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .seed-modal-confirm {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
        }

        .seed-modal-confirm:hover {
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.5);
        }

        .seed-modal-confirm:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Owner Dashboard */
        .owner-dashboard {
            margin: 8px auto;
            padding: 10px;
            background: rgba(155, 89, 182, 0.15);
            border-radius: 10px;
            border: 2px dashed rgba(155, 89, 182, 0.4);
            max-width: 560px;
        }

        .owner-dashboard-header {
            color: #9B59B6;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .owner-dashboard-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .owner-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .owner-input-group label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 10px;
            text-transform: uppercase;
        }

        .owner-input-group input {
            width: 80px;
            padding: 5px 8px;
            border-radius: 6px;
            border: 1px solid rgba(155, 89, 182, 0.5);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 12px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .owner-input-group input:focus {
            outline: none;
            border-color: #9B59B6;
        }

        .owner-set-btn {
            padding: 4px 12px;
            border-radius: 4px;
            border: none;
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .owner-set-btn:hover {
            box-shadow: 0 2px 10px rgba(155, 89, 182, 0.5);
        }

        .owner-set-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .telegram-btn .action-box-icon {
            width: 34px;
            height: 34px;
        }

        .action-box-icon {
            width: 52px;
            height: 52px;
            border-radius: 50%;
        }

        /* Burnt Display */
        .burnt-display {
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 4px 8px;
            background: rgba(231, 76, 60, 0.15);
            border-radius: 8px;
            border: 2px solid rgba(231, 76, 60, 0.3);
        }

        .burnt-label {
            color: #E74C3C;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .burnt-value {
            color: #FF6B6B;
            font-size: 15px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .burnt-logo {
            width: 16px;
            height: 16px;
        }

        /* Wallet Balance Only */
        .wallet-balance-only {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 6px;
        }

        /* Owner Seed Deposit Section */
        .owner-seed-container {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 8px;
            background: rgba(155, 89, 182, 0.25);
            border-radius: 10px;
            border: 2px dashed rgba(155, 89, 182, 0.6);
            z-index: 100;
        }

        .owner-seed-input-container {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .owner-seed-input {
            background: transparent;
            border: none;
            color: white;
            font-size: 14px;
            font-weight: bold;
            width: 60px;
            text-align: center;
            font-family: 'Courier New', monospace;
            outline: none;
        }

        .owner-seed-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .owner-seed-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .owner-seed-btn {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
            font-size: 12px;
            font-weight: bold;
            padding: 6px 12px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .owner-seed-btn:hover {
            background: linear-gradient(135deg, #8E44AD 0%, #7D3C98 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4);
        }

        .owner-seed-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Cost Display */
        .cost-display {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            margin-top: 5px;
        }

        .cost-label {
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: bold;
            color: #E74C3C;
        }

        .cost-value {
            font-family: 'Courier New', monospace;
            color: #E74C3C;
            font-weight: bold;
            font-size: 15px;
        }

        .title {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 48px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 
                3px 3px 6px rgba(0,0,0,0.3),
                0 0 20px rgba(231, 76, 60, 0.6),
                0 0 40px rgba(231, 76, 60, 0.4);
            animation: float 3s ease-in-out infinite, fire-glow 2s ease-in-out infinite;
            opacity: 0.7;
            pointer-events: none;
            z-index: 100;
        }

        @keyframes fire-glow {
            0%, 100% { 
                text-shadow: 
                    3px 3px 6px rgba(0,0,0,0.3),
                    0 0 20px rgba(231, 76, 60, 0.6),
                    0 0 40px rgba(231, 76, 60, 0.4);
            }
            50% { 
                text-shadow: 
                    3px 3px 6px rgba(0,0,0,0.3),
                    0 0 30px rgba(255, 87, 34, 0.8),
                    0 0 60px rgba(255, 152, 0, 0.6);
            }
        }

        /* Game Info Display */
        .game-info-container {
            max-width: 500px;
            margin: 65px auto 5px auto;
            padding: 0 20px;
            position: relative;
            z-index: 50;
        }

        .game-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .game-info-row.center {
            justify-content: center;
        }

        .game-info-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            padding: 6px 14px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .game-info-item.timer-display {
            padding: 8px 20px;
            gap: 10px;
        }

        .game-info-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: bold;
        }

        .timer-display .game-info-label {
            font-size: 18px;
        }

        .game-info-value {
            color: white;
            font-size: 22px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .timer-display .game-info-value {
            font-size: 20px;
            letter-spacing: 1px;
            transition: color 0.3s ease;
        }

        .timer-display .game-info-value.hot-zone {
            color: #E74C3C;
            animation: pulse-red 1s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { color: #E74C3C; }
            50% { color: #FF6B6B; }
        }

        .game-info-value.highlight {
            color: #F39C12;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Particle effects */
        .particle {
            position: fixed;
            pointer-events: none;
            font-size: 24px;
            animation: particle-float 1s ease-out forwards;
            z-index: 1000;
        }

        @keyframes particle-float {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.5);
            }
        }

        /* Game Over State */
        .chicken.exploded {
            animation: explode 0.5s ease-out forwards;
        }

        @keyframes explode {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.3) rotate(10deg);
                opacity: 0.5;
            }
            100% {
                transform: scale(0.3) rotate(360deg);
                opacity: 0;
            }
        }

        .rooster-combo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            z-index: 100002;
            display: none;
            pointer-events: none;
        }

        .rooster-combo img {
            width: 350px;
            height: auto;
            filter: drop-shadow(0 0 30px rgba(243, 156, 18, 0.9));
        }

        .rooster-combo.show {
            display: block;
            animation: combo-popup 2.5s ease-out forwards;
        }

        .rooster-combo-10x {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            z-index: 100003;
            display: none;
            pointer-events: none;
        }

        .rooster-combo-10x img {
            width: 400px;
            height: auto;
            filter: drop-shadow(0 0 30px rgba(255, 100, 0, 0.8));
        }

        .rooster-combo-10x.show {
            display: block;
            animation: combo-popup-10x 5s ease-out forwards;
        }

        @keyframes combo-popup-10x {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            8% {
                transform: translate(-50%, -50%) scale(1.15);
                opacity: 1;
            }
            15% {
                transform: translate(-50%, -50%) scale(1);
            }
            92% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.7);
                opacity: 0;
            }
        }

        @keyframes combo-popup {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-10deg);
                opacity: 0;
            }
            15% {
                transform: translate(-50%, -50%) scale(1.3) rotate(5deg);
                opacity: 1;
            }
            30% {
                transform: translate(-50%, -50%) scale(0.9) rotate(-3deg);
            }
            45% {
                transform: translate(-50%, -50%) scale(1.1) rotate(2deg);
            }
            60% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
            85% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
                opacity: 0;
            }
        }

        .game-over-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(231, 76, 60, 0.95);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border: 3px solid #C0392B;
            box-shadow: 0 0 30px rgba(231, 76, 60, 0.8);
            animation: flash 1s ease-in-out infinite;
            z-index: 100001;
            display: none;
        }

        .game-over-message.show {
            display: block;
        }

        .burnt-bones {
            margin-top: 15px;
            font-size: 32px;
            opacity: 0.8;
            filter: grayscale(30%);
            letter-spacing: 8px;
        }

        @keyframes flash {
            0%, 100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                opacity: 0.7;
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        .feathers {
            position: absolute;
            font-size: 30px;
            pointer-events: none;
            animation: float-feather 3s ease-out forwards;
        }

        @keyframes float-feather {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-200px) rotate(720deg);
                opacity: 0;
            }
        }

        /* Hide custom hand cursor on mobile/tablet devices */
        @media (pointer: coarse) {
            .hand-cursor {
                display: none !important;
            }
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }

            .game-container {
                padding: 3px;
                max-width: 100%;
                overflow-x: hidden;
            }

            /* Title - prevent wrapping, position properly above timer */
            .title {
                font-size: 26px !important;
                top: 3px;
                padding: 0 3px;
                left: 0;
                right: 0;
                position: relative;
                margin-bottom: 0;
            }

            /* Stats at top - push down more to avoid overlap */
            .stats-container {
                margin-top: 55px;
                grid-template-columns: 1fr;
                gap: 6px;
                padding: 6px;
                max-width: 100%;
            }

            .stat-box {
                padding: 6px;
            }

            .stat-label {
                font-size: 10px;
            }

            .stat-value {
                font-size: 15px;
            }

            /* Game info - push down below title, tighter spacing */
            .game-info-container {
                gap: 6px;
                margin: 18px auto 5px auto;
                max-width: 100%;
                flex-wrap: nowrap;
                padding: 0 10px;
            }

            .game-info-row {
                margin-bottom: 4px;
            }

            .game-info-item {
                padding: 5px 10px;
                gap: 8px;
            }

            .game-info-item.timer-display {
                padding: 6px 14px;
            }

            .timer-display .game-info-label {
                font-size: 14px;
            }

            .timer-display .game-info-value {
                font-size: 16px;
            }

            .game-info-box {
                padding: 5px 8px;
                min-width: 0;
                flex: 1 1 0;
            }

            .game-info-label {
                font-size: 12px;
                margin-bottom: 2px;
                white-space: nowrap;
            }

            .game-info-value {
                font-size: 14px;
            }

            .eshare-symbol {
                width: 14px;
                height: 14px;
            }

            /* Chicken area - reduce height to prevent overlap */
            .chicken-area {
                min-height: 190px;
                padding-top: 0;
                max-width: 100%;
            }

            .chicken {
                width: 150px;
                height: 150px;
            }

            /* Hotzone messages - smaller on mobile */
            .hotzone-message {
                top: 45%;
            }

            .hotzone-text {
                font-size: 14px;
                letter-spacing: 1px;
            }

            .hotzone-bonus {
                font-size: 10px;
            }

            .hotzone-left {
                left: 2px;
            }

            .hotzone-right {
                right: 2px;
            }

            /* Grab button - closer to chicken */
            .grab-button-container {
                margin-top: -35px;
            }

            /* Leaderboard container */
            .leaderboard-container {
                max-width: 100%;
                overflow-x: hidden;
                padding: 8px;
            }

            /* Chicken coop leaderboard - bigger title */
            .leaderboard-title {
                font-size: 18px;
                margin-bottom: 8px;
            }

            .chicken-coop-title {
                font-size: 18px;
                padding: 6px;
            }

            /* Column headers - mobile grid with bigger fonts */
            .leaderboard-column-headers {
                grid-template-columns: 55px 1fr 80px 80px;
                gap: 4px;
                padding: 5px 8px;
            }

            .leaderboard-column-headers span {
                font-size: 11px;
            }

            .leaderboard-headers {
                font-size: 12px;
                padding: 5px 6px;
            }

            /* Lead plucker - bigger fonts for readability */
            .current-holder {
                padding: 8px 10px;
                gap: 5px;
                grid-template-columns: 55px 1fr 80px 80px;
            }

            .current-holder-label {
                font-size: 11px;
                letter-spacing: 0.3px;
            }

            .current-holder-address {
                font-size: 14px;
            }

            .current-holder-amount {
                font-size: 15px;
                gap: 3px;
            }

            .current-holder-amount .eshare-symbol {
                width: 17px;
                height: 17px;
            }

            .current-holder-winnings {
                font-size: 15px;
                gap: 3px;
            }

            .current-holder-winnings .eshare-symbol {
                width: 17px;
                height: 17px;
            }

            .holder-item {
                padding: 8px 10px;
                font-size: 14px;
                gap: 5px;
                grid-template-columns: 55px 1fr 80px 80px;
            }

            .holder-rank {
                font-size: 14px;
                min-width: 26px;
            }

            .holder-address {
                font-size: 13px;
                flex: 1;
                min-width: 0;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .holder-amount, .holder-winnings {
                font-size: 14px;
                white-space: nowrap;
            }

            .holder-amount .eshare-symbol,
            .holder-winnings .eshare-symbol {
                width: 16px;
                height: 16px;
            }

            /* Previous winners - bigger fonts */
            .previous-winners-container {
                max-width: 100%;
                overflow-x: hidden;
                padding: 10px;
            }

            .previous-winners-title {
                font-size: 16px;
                padding: 6px;
                margin-bottom: 8px;
            }

            .winner-item {
                padding: 10px 12px;
            }

            .winner-round {
                font-size: 14px;
            }

            .winner-address {
                font-size: 14px;
            }

            .winner-amount {
                font-size: 16px;
            }

            .winner-amount .eshare-symbol {
                width: 17px;
                height: 17px;
            }

            .lotto-badge {
                font-size: 11px;
                padding: 3px 10px;
            }

            /* Amount input */
            .amount-input-container {
                margin: 8px auto;
                max-width: 100%;
            }

            .amount-input {
                font-size: 16px;
                padding: 6px;
                width: 110px;
            }

            .amount-label {
                font-size: 11px;
            }

            .amount-min-label {
                font-size: 9px;
            }

            /* Connect wallet button */
            .connect-wallet {
                font-size: 14px;
                padding: 10px 16px;
                max-width: 90%;
            }

            .connected-wallet {
                font-size: 10px;
            }

            #connectedAddress {
                font-size: 11px;
            }

            .wallet-balance-only {
                font-size: 11px;
            }

            .balance-value {
                font-size: 13px;
            }

            /* Actions box - tighter spacing, telegram smaller */
            .actions-box {
                flex-wrap: nowrap;
                gap: 4px;
                padding: 5px;
                margin: 8px auto;
                max-width: 100%;
            }

            .action-box-btn {
                font-size: 14px;
                padding: 4px 8px;
                gap: 5px;
            }

            .action-box-logo {
                width: 20px;
                height: 20px;
            }

            .action-box-icon {
                width: 20px;
                height: 20px;
            }

            /* Telegram icon 20% smaller */
            .telegram-btn .action-box-icon {
                width: 16px;
                height: 16px;
            }

            .burnt-display {
                padding: 4px 7px;
                font-size: 11px;
                white-space: nowrap;
            }

            .burnt-value {
                font-size: 12px;
            }

            .burnt-logo {
                width: 14px;
                height: 14px;
            }

            .burnt-label {
                font-size: 9px;
            }

            /* Combo popups */
            .rooster-combo {
                font-size: 22px;
                padding: 18px 25px;
                max-width: 90%;
            }

            .rooster-combo-10x {
                font-size: 26px;
                padding: 20px 28px;
                max-width: 90%;
            }

            /* Scroll indicator */
            .scroll-indicator {
                font-size: 9px;
            }
        }

        /* Extra small mobile devices */
        @media (max-width: 480px) {
            .title {
                font-size: 22px !important;
                top: 2px;
            }

            .stats-container {
                margin-top: 40px;
            }

            .stat-value {
                font-size: 14px;
            }

            /* Smaller chicken for small screens */
            .chicken {
                width: 130px;
                height: 130px;
            }

            .chicken-area {
                min-height: 170px;
            }

            /* Grab button container - closer to chicken */
            .grab-button-container {
                margin-top: -30px;
            }

            /* Game info adjustments */
            .game-info-container {
                margin: 24px auto 4px auto;
            }

            .game-info-box {
                padding: 4px 6px;
            }

            .game-info-label {
                font-size: 11px;
            }

            .game-info-value {
                font-size: 13px;
            }

            .timer-display .game-info-label {
                font-size: 12px;
            }

            .timer-display .game-info-value {
                font-size: 14px;
            }

            .eshare-symbol {
                width: 13px;
                height: 13px;
            }

            /* Lead plucker - readable on tiny screens */
            .current-holder {
                padding: 6px 8px;
                gap: 4px;
                grid-template-columns: 50px 1fr 68px 68px;
            }

            .current-holder-label {
                font-size: 9px;
            }

            .current-holder-address {
                font-size: 12px;
            }

            .current-holder-amount {
                font-size: 12px;
            }

            .current-holder-amount .eshare-symbol {
                width: 14px;
                height: 14px;
            }

            .current-holder-winnings {
                font-size: 12px;
            }

            .current-holder-winnings .eshare-symbol {
                width: 14px;
                height: 14px;
            }

            /* Holder item grid for tiny screens */
            .holder-item {
                font-size: 12px;
                padding: 6px 8px;
                gap: 4px;
                grid-template-columns: 50px 1fr 68px 68px;
            }

            .holder-rank {
                font-size: 12px;
                min-width: 24px;
            }

            .holder-address {
                font-size: 11px;
            }

            .holder-amount, .holder-winnings {
                font-size: 12px;
            }

            .holder-amount .eshare-symbol,
            .holder-winnings .eshare-symbol {
                width: 13px;
                height: 13px;
            }

            /* Column headers for tiny screens */
            .leaderboard-column-headers {
                grid-template-columns: 50px 1fr 68px 68px;
            }

            .leaderboard-column-headers span {
                font-size: 9px;
            }

            /* Previous winners for tiny screens */
            .previous-winners-title {
                font-size: 13px;
            }

            .winner-round {
                font-size: 11px;
            }

            .winner-address {
                font-size: 11px;
            }

            .winner-amount {
                font-size: 12px;
            }

            .amount-input {
                font-size: 15px;
                width: 100px;
            }

            .connect-wallet {
                font-size: 13px;
                padding: 8px 14px;
            }

            /* Actions box - tighter */
            .actions-box {
                gap: 3px;
            }

            .action-box-btn {
                font-size: 12px;
                padding: 3px 6px;
            }

            .telegram-btn .action-box-icon {
                width: 14px;
                height: 14px;
            }

            .burnt-display {
                padding: 3px 5px;
                font-size: 9px;
            }

            .burnt-value {
                font-size: 10px;
            }

            .burnt-label {
                font-size: 8px;
            }

            .burnt-logo {
                width: 12px;
                height: 12px;
            }
        }

        /* Landscape mobile - reduce vertical space */
        @media (max-width: 768px) and (orientation: landscape) {
            .chicken-area {
                min-height: 250px;
            }

            .chicken {
                width: 160px;
                height: 160px;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <script>
        // Scroll to top on page load/refresh
        window.onbeforeunload = function () {
            window.scrollTo(0, 0);
        };
        // Also scroll to top immediately when page loads
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        window.scrollTo(0, 0);
    </script>
    <div class="game-container">
        <h1 class="title"> HOT CHICKEN </h1>
        
        <!-- Game Info -->
        <div class="game-info-container">
            <div class="game-info-row center">
                <div class="game-info-item timer-display">
                    <span class="game-info-label">Timer</span>
                    <span class="game-info-value" id="timer">00h : 00m : 00s</span>
                </div>
            </div>
            <div class="game-info-row">
                <div class="game-info-item">
                    <span class="game-info-label">Seed:</span>
                    <span class="game-info-value highlight" id="seedEshare">0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E"></span>
                </div>
                <div class="game-info-item">
                    <span class="game-info-label">Pool:</span>
                    <span class="game-info-value highlight" id="poolEshare">0.000 <img src="eshare-logo.png" class="eshare-symbol" alt="E"></span>
                </div>
            </div>
        </div>
        
        <div class="chicken-area">
            <!-- Hotzone Messages - Left -->
            <div class="hotzone-message hotzone-left" id="hotzoneLeft">
                <span class="hotzone-text">HOTZONE!</span>
                <span class="hotzone-bonus">+10% BONUS</span>
            </div>
            
            <!-- Hotzone Messages - Right -->
            <div class="hotzone-message hotzone-right" id="hotzoneRight">
                <span class="hotzone-text">HOTZONE!</span>
                <span class="hotzone-bonus">+10% BONUS</span>
            </div>
            
            <!-- Game Over Message -->
            <div class="game-over-message" id="gameOverMessage">
                 GAME OVER! <br>
                <span style="font-size: 18px; margin-top: 10px; display: block;">Get paid and start new round with new minimum bid!</span>
                <div class="burnt-bones"></div>
            </div>
            
            <!-- 5x Rooster Combo Popup -->
            <div class="rooster-combo" id="roosterCombo5x">
                <img src="crazyrooster1.webp" alt="Crazy Speed Rooster Combo!">
            </div>
            
            <!-- 10x Rooster Combo Popup -->
            <!-- 10x Rooster Combo Popup -->
            <div class="rooster-combo-10x" id="roosterCombo10x">
                <img src="crazyrooster2.webp" alt="Ludicrous Speed Rooster Combo!">
            </div>
            
            <div class="chicken" id="chicken">
                <svg class="chicken-body" viewBox="0 0 300 450" xmlns="http://www.w3.org/2000/svg">
                    <!-- Flowing tail feathers - dramatic curves like reference -->
                    <path d="M 60 260 Q 20 240 15 200 Q 12 180 25 170 Q 35 165 45 175 Q 50 200 55 230 Z" 
                          fill="#2C3E50" stroke="#1A252F" stroke-width="2"/>
                    <path d="M 65 250 Q 30 235 25 200 Q 22 175 35 165 Q 48 160 58 172 Q 62 200 63 235 Z" 
                          fill="#16A085" stroke="#117A65" stroke-width="2"/>
                    <path d="M 68 270 Q 35 260 28 225 Q 25 195 38 185 Q 50 180 60 192 Q 65 220 66 255 Z" 
                          fill="#3498DB" stroke="#2874A6" stroke-width="2"/>
                    <path d="M 70 285 Q 40 275 35 245 Q 32 215 45 205 Q 58 200 65 210 Q 70 235 69 270 Z" 
                          fill="#9B59B6" stroke="#7D3C98" stroke-width="2"/>
                    
                    <!-- Body - smaller round green -->
                    <ellipse cx="150" cy="260" rx="70" ry="75" fill="#2ECC71" stroke="#27AE60" stroke-width="3"/>
                    
                    <!-- Wings - darker teal ovals -->
                    <ellipse cx="95" cy="255" rx="32" ry="48" fill="#16A085" stroke="#0E6655" stroke-width="3"/>
                    <ellipse cx="205" cy="255" rx="32" ry="48" fill="#16A085" stroke="#0E6655" stroke-width="3"/>
                    
                    <!-- Neck - long tapered orange (wrapped for squeeze) -->
                    <g class="neck-squeeze">
                        <path d="M 138 210 Q 142 160 145 120 Q 150 115 155 120 Q 158 160 162 210 Z" 
                              fill="#E67E22" stroke="#D35400" stroke-width="3"/>
                    </g>
                    
                    <!-- Head group (wrapped for squeeze animation) -->
                    <g class="head-squeeze">
                        <!-- Head - round orange -->
                        <circle cx="150" cy="80" r="50" fill="#E67E22" stroke="#D35400" stroke-width="3"/>
                        
                        <!-- DRAMATIC MOHAWK COMB - spiky and big like reference -->
                        <path d="M 125 45 L 130 20 L 135 40 L 138 15 L 142 38 L 145 10 L 150 35 L 155 8 L 158 38 L 162 12 L 165 40 L 170 18 L 175 45 Z" 
                              fill="#E74C3C" stroke="#C0392B" stroke-width="2.5"/>
                        
                        <!-- Long wattles - hanging down lower -->
                        <ellipse cx="138" cy="125" rx="6" ry="22" fill="#E74C3C" stroke="#C0392B" stroke-width="2"/>
                        <ellipse cx="162" cy="125" rx="6" ry="22" fill="#E74C3C" stroke="#C0392B" stroke-width="2"/>
                        
                        <!-- Eyes - BIG derpy eyes with spinning pupils -->
                        <g class="eye-left eye-squeeze">
                            <ellipse cx="135" cy="70" rx="16" ry="18" fill="white" stroke="#2C3E50" stroke-width="2.5"/>
                            <circle cx="135" cy="70" r="7" fill="#2C3E50" class="pupil-left"/>
                        </g>
                        <g class="eye-right eye-squeeze">
                            <ellipse cx="165" cy="70" rx="16" ry="18" fill="white" stroke="#2C3E50" stroke-width="2.5"/>
                            <circle cx="165" cy="70" r="7" fill="#2C3E50" class="pupil-right"/>
                        </g>
                        
                        <!-- Beak - bright yellow -->
                        <path d="M 150 85 L 135 95 L 150 100 Z" fill="#FFEB3B" stroke="#FBC02D" stroke-width="2"/>
                    </g>
                    
                    <!-- Legs - LONGER skinny orange legs -->
                    <rect x="132" y="325" width="6" height="95" fill="#E67E22" stroke="#D35400" stroke-width="2"/>
                    <rect x="162" y="325" width="6" height="95" fill="#E67E22" stroke="#D35400" stroke-width="2"/>
                    
                    <!-- Feet - three-toed chicken feet -->
                    <!-- Left foot -->
                    <line x1="130" y1="420" x2="120" y2="433" stroke="#E67E22" stroke-width="5" stroke-linecap="round"/>
                    <line x1="135" y1="420" x2="135" y2="435" stroke="#E67E22" stroke-width="5" stroke-linecap="round"/>
                    <line x1="140" y1="420" x2="148" y2="433" stroke="#E67E22" stroke-width="5" stroke-linecap="round"/>
                    
                    <!-- Right foot -->
                    <line x1="160" y1="420" x2="152" y2="433" stroke="#E67E22" stroke-width="5" stroke-linecap="round"/>
                    <line x1="165" y1="420" x2="165" y2="435" stroke="#E67E22" stroke-width="5" stroke-linecap="round"/>
                    <line x1="170" y1="420" x2="180" y2="433" stroke="#E67E22" stroke-width="5" stroke-linecap="round"/>
                    
                    <!-- Toe tips -->
                    <circle cx="120" cy="433" r="4" fill="#D35400"/>
                    <circle cx="135" cy="435" r="4" fill="#D35400"/>
                    <circle cx="148" cy="433" r="4" fill="#D35400"/>
                    <circle cx="152" cy="433" r="4" fill="#D35400"/>
                    <circle cx="165" cy="435" r="4" fill="#D35400"/>
                    <circle cx="180" cy="433" r="4" fill="#D35400"/>
                </svg>
                
                <!-- Hot Zone Smoke -->
                <div class="hotzone-smoke" id="hotzone Smoke">
                    <div class="smoke-particle"></div>
                    <div class="smoke-particle"></div>
                    <div class="smoke-particle"></div>
                </div>
            </div>
        </div>

        <!-- Grab Button -->
        <div class="grab-button-container">
            <button class="connect-wallet" id="connectWallet">Connect Wallet</button>
            
            <div class="connected-wallet" id="connectedWallet" style="display: none;">
                <span style="color: #3498DB; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">Connected:</span>
                <span id="connectedAddress" style="color: #3498DB; font-weight: bold; font-size: 12px; font-family: 'Courier New', monospace;"></span>
            </div>
            
            <div class="amount-input-container" id="amountContainer">
                <input 
                    type="number" 
                    class="amount-input" 
                    id="eshareAmount" 
                    placeholder="0.1000" 
                    min="0.0001" 
                    step="0.0001" 
                    value="0.1000"
                />
                <label class="amount-label">ESHARE</label>
                <label class="amount-min-label">min.</label>
            </div>
            
            <div class="wallet-balance-only">
                <span class="balance-label">Wallet:</span>
                <span class="balance-value" id="balanceValue">0.00 ESHARE</span>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard-container">
            <div class="leaderboard-title"> THE CHICKEN COOP </div>
            
            <div class="leaderboard-column-headers">
                <span class="header-rank"></span>
                <span class="header-address"></span>
                <span class="header-deposits">Total Bids</span>
                <span class="header-winnings">Potential Winnings</span>
            </div>
            
            <div class="current-holder">
                <div class="current-holder-label">Lead Plucker:</div>
                <div class="current-holder-address" id="currentHolder">0x0000...0000</div>
                <div class="current-holder-amount" id="currentAmount">0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E"></div>
                <div class="current-holder-winnings" id="currentWinnings">0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E"></div>
            </div>

            <div class="previous-holders-label">Past Pluckers</div>
            <div class="previous-holders-wrapper" style="position: relative;">
                <div class="previous-holders" id="previousHolders">
                    <!-- Populated by JavaScript -->
                </div>
                <div class="scroll-indicator" id="scrollIndicator">
                    Scroll 
                </div>
            </div>
        </div>

        <!-- Previous Winners Box -->
        <div class="previous-winners-container">
            <div class="previous-winners-title"> PREVIOUS PLUCKERS </div>
            <div class="previous-winners-list" id="previousWinnersList">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Actions Box (below leaderboard) -->
        <div class="actions-box">
            <a href="https://app.uniswap.org/swap?outputCurrency=0xb7C10146bA1b618956a38605AB6496523d450871&chain=base" target="_blank" class="action-box-btn buy-btn" data-tooltip="Buy ESHARE on Uniswap">
                BUY <img src="eshare-logo.png" class="action-box-logo" alt="E">
            </a>
            
            <div class="burnt-display">
                <span class="burnt-label">BURNT:</span>
                <span class="burnt-value" id="totalBurnt">0.000</span>
                <img src="eshare-logo.png" class="burnt-logo" alt="E">
            </div>
            
            <div class="burnt-display" style="background: rgba(52, 152, 219, 0.15); border-color: rgba(52, 152, 219, 0.3);">
                <span class="burnt-label" style="color: #3498DB;">VAULT:</span>
                <span class="burnt-value" id="vaultBalance">0.00</span>
                <img src="eshare-logo.png" class="burnt-logo" alt="E">
            </div>
            
            <button class="action-box-btn seed-btn" id="openSeedModal" data-tooltip="Deposit seed">
                
            </button>
            
            <a href="whitepaper.html" target="_blank" class="action-box-btn whitepaper-btn" data-tooltip="Read the Whitepaper">
                <img src="whitepaper-logo.webp" alt="Whitepaper" class="action-box-icon">
            </a>
            
            <a href="#" id="telegramLink" class="action-box-btn telegram-btn" target="_blank" data-tooltip="Join our Telegram">
                <img src="telegram-logo.webp" alt="Telegram" class="action-box-icon">
            </a>
        </div>
        
        <!-- Seed Deposit Modal -->
        <div class="seed-modal-overlay" id="seedModalOverlay">
            <div class="seed-modal">
                <div class="seed-modal-header">
                     Deposit Seed 
                </div>
                <div class="seed-modal-body">
                    <p class="seed-modal-desc">Add to the seed vault to reward Lead Pluckers!</p>
                    <div class="seed-modal-input-row">
                        <input type="number" class="seed-modal-input" id="seedModalAmount" placeholder="1.00" min="0.01" step="0.01" value="1.00">
                        <span class="seed-modal-label">ESHARE</span>
                    </div>
                </div>
                <div class="seed-modal-buttons">
                    <button class="seed-modal-btn seed-modal-cancel" id="seedModalCancel">Cancel</button>
                    <button class="seed-modal-btn seed-modal-confirm" id="seedModalConfirm">Deposit</button>
                </div>
            </div>
        </div>
        
        <!-- Owner Dashboard (only visible to owner) -->
        <div class="owner-dashboard" id="ownerDashboard" style="display: none;">
            <div class="owner-dashboard-header"> Owner Dashboard</div>
            <div class="owner-dashboard-row">
                <div class="owner-input-group">
                    <label>Timer Blocks</label>
                    <input type="number" id="ownerTimerBlocks" placeholder="1800" min="1">
                    <button class="owner-set-btn" id="setTimerBlocksBtn">Set</button>
                </div>
                <div class="owner-input-group">
                    <label>Min Grab (ESHARE)</label>
                    <input type="number" id="ownerMinGrab" placeholder="0.001" min="0.0001" step="0.0001">
                    <button class="owner-set-btn" id="setMinGrabBtn">Set</button>
                </div>
                <div class="owner-input-group">
                    <label>Seed/Round (ESHARE)</label>
                    <input type="number" id="ownerSeedAmount" placeholder="0.002" min="0.0001" step="0.0001">
                    <button class="owner-set-btn" id="setSeedAmountBtn">Set</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Hand cursor -->
    <div class="hand-cursor" id="handCursor">
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <!-- Open hand -->
            <g id="handOpen">
                <path d="M 30 70 L 30 40 Q 30 35 35 35 Q 40 35 40 40 L 40 30 Q 40 25 45 25 Q 50 25 50 30 L 50 25 Q 50 20 55 20 Q 60 20 60 25 L 60 30 Q 60 25 65 25 Q 70 25 70 30 L 70 50 Q 75 55 75 65 Q 75 80 65 85 L 40 85 Q 30 80 30 70 Z" 
                      fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
            </g>
            <!-- Closed hand (hidden by default) -->
            <g id="handClosed" style="display: none;">
                <ellipse cx="50" cy="60" rx="25" ry="30" fill="#FFD700" stroke="#FFA500" stroke-width="2"/>
                <circle cx="45" cy="50" r="8" fill="#FFA500"/>
                <circle cx="55" cy="50" r="8" fill="#FFA500"/>
                <circle cx="50" cy="65" r="8" fill="#FFA500"/>
            </g>
        </svg>
    </div>

    <script>
        // Game state
        let chickenX = 0;
        let chickenY = 0;
        let isDodging = false;

        // Elements
        const chicken = document.getElementById('chicken');
        const handCursor = document.getElementById('handCursor');
        const handOpen = document.getElementById('handOpen');
        const handClosed = document.getElementById('handClosed');

        // Create audio elements for chicken sounds
        const hoverSound = new Audio('chicken1.mp3');
        const clickSound = new Audio('chicken2.mp3');
        const roosterSound = new Audio('rooster1.mp3');
        const growlSound = new Audio('chickengrowl1.wav');
        const chicken10xSound = new Audio('chicken10x.wav');
        hoverSound.volume = 0.3;
        clickSound.volume = 0.5;
        roosterSound.volume = 0.6;
        growlSound.volume = 0.525; // 25% quieter (was 0.7)
        chicken10xSound.volume = 0.8;
        
        // Track rapid clicks for rooster sound
        let clickTimes = [];
        
        // Track hovers for growl sound
        let hoverTimes = [];
        let lastGrowlTime = 0;
        let lastHoverSoundTime = 0;
        
        let isHovering = false;
        
        function createHoverSound() {
            try {
                const now = Date.now();
                hoverTimes.push(now);
                
                // Remove hovers older than 1 second
                hoverTimes = hoverTimes.filter(time => now - time < 1000);
                
                // If 5 hovers within 1 second AND at least 4 seconds since last growl, play growl
                if (hoverTimes.length >= 5 && (now - lastGrowlTime) >= 4000) {
                    console.log(' GROWL! 5 hovers in 1 second!');
                    growlSound.currentTime = 0;
                    growlSound.play().catch(e => console.log('Growl sound play failed:', e));
                    lastGrowlTime = now; // Update last growl time
                    hoverTimes = []; // Reset counter
                } else if ((now - lastHoverSoundTime) >= 500) {
                    // Only play hover sound if at least 0.5 seconds have passed
                    hoverSound.currentTime = 0;
                    hoverSound.play().catch(e => console.log('Hover sound play failed:', e));
                    lastHoverSoundTime = now;
                }
            } catch (e) {
                console.log('Hover sound error:', e);
            }
        }
        
        function createSquawkSound() {
            try {
                clickSound.currentTime = 0;
                clickSound.play().catch(e => console.log('Click sound play failed:', e));
                
                // Track click timing
                const now = Date.now();
                clickTimes.push(now);
                
                // Remove clicks older than 5 seconds (for the 10-click combo)
                clickTimes = clickTimes.filter(time => now - time < 5000);
                
                // Count clicks within 2 seconds for the 9-click combo
                const clicksIn2Sec = clickTimes.filter(time => now - time < 2000).length;
                
                // Check for 9x combo first (9 clicks in 2 seconds) - highest priority
                if (clicksIn2Sec >= 9) {
                    console.log(' MEGA ROOSTER! 9 clicks in 2 seconds!');
                    chicken10xSound.currentTime = 0;
                    chicken10xSound.play().catch(e => console.log('9x sound play failed:', e));
                    
                    // Show 10x combo popup (still called 10x for display)
                    show10xCombo();
                    
                    clickTimes = []; // Reset counter
                }
                // If 10 clicks within 5 seconds, play rooster sound and show 5x combo
                else if (clickTimes.length >= 10) {
                    console.log(' ROOSTER ACTIVATED! 10 clicks in 5 seconds!');
                    roosterSound.currentTime = 0;
                    roosterSound.play().catch(e => console.log('Rooster sound play failed:', e));
                    
                    // Show 5x combo popup
                    show5xCombo();
                    
                    clickTimes = []; // Reset counter
                }
            } catch (e) {
                console.log('Click sound error:', e);
            }
        }
        
        function show5xCombo() {
            const comboPopup = document.getElementById('roosterCombo5x');
            comboPopup.classList.add('show');
            
            // Hide after 2 seconds
            setTimeout(() => {
                comboPopup.classList.remove('show');
            }, 2000);
        }
        
        function show10xCombo() {
            const comboPopup = document.getElementById('roosterCombo10x');
            comboPopup.classList.add('show');
            
            // Hide after 5 seconds
            setTimeout(() => {
                comboPopup.classList.remove('show');
            }, 5000);
        }

        // Follow cursor with hand and make chicken dodge
        let mouseX = 0;
        let mouseY = 0;
        
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            
            handCursor.style.left = e.clientX + 'px';
            handCursor.style.top = e.clientY + 'px';
            
            // Make chicken dodge if hand is near
            const chickenRect = chicken.getBoundingClientRect();
            const chickenCenterX = chickenRect.left + chickenRect.width / 2;
            const chickenCenterY = chickenRect.top + chickenRect.height / 2;
            
            const distX = mouseX - chickenCenterX;
            const distY = mouseY - chickenCenterY;
            const distance = Math.sqrt(distX * distX + distY * distY);
            
            // If hand is within 200px, chicken dodges away
            if (distance < 200 && !chicken.classList.contains('grabbed')) {
                isDodging = true;
                chicken.classList.add('dodging');
                
                // Calculate dodge direction (away from cursor)
                const dodgeAmount = 30;
                const angle = Math.atan2(distY, distX);
                const dodgeX = -Math.cos(angle) * dodgeAmount;
                const dodgeY = -Math.sin(angle) * dodgeAmount;
                
                // Apply dodge with rotation for funny effect
                const rotateAmount = (distX > 0) ? -8 : 8;
                chicken.style.transform = `translate(${dodgeX}px, ${dodgeY}px) rotate(${rotateAmount}deg)`;
            } else if (isDodging && !chicken.classList.contains('grabbed')) {
                // Return to normal position
                chicken.style.transform = 'translate(0, 0) rotate(0deg)';
                isDodging = false;
                setTimeout(() => chicken.classList.remove('dodging'), 200);
            }
        });

        // Click chicken for animations and sounds (no blockchain call)
        chicken.addEventListener('click', (e) => {
            playChickenAnimation(e);
        });

        // Hover sound effect
        chicken.addEventListener('mouseenter', () => {
            if (!isHovering) {
                isHovering = true;
                createHoverSound();
            }
        });

        chicken.addEventListener('mouseleave', () => {
            isHovering = false;
        });

        function playChickenAnimation(e) {
            // Visual effects
            chicken.classList.add('grabbed', 'wiggle');
            handCursor.classList.add('grabbing');
            handOpen.style.display = 'none';
            handClosed.style.display = 'block';
            
            // Create squawk sound
            createSquawkSound();
            
            // Create particles
            createParticles(e.clientX, e.clientY);
            
            // Reset after animation
            setTimeout(() => {
                chicken.classList.remove('grabbed');
                handOpen.style.display = 'block';
                handClosed.style.display = 'none';
                handCursor.classList.remove('grabbing');
                // Return to dodge position if still hovering
                if (isDodging) {
                    const chickenRect = chicken.getBoundingClientRect();
                    const chickenCenterX = chickenRect.left + chickenRect.width / 2;
                    const chickenCenterY = chickenRect.top + chickenRect.height / 2;
                    const distX = mouseX - chickenCenterX;
                    const distY = mouseY - chickenCenterY;
                    const dodgeAmount = 30;
                    const angle = Math.atan2(distY, distX);
                    const dodgeX = -Math.cos(angle) * dodgeAmount;
                    const dodgeY = -Math.sin(angle) * dodgeAmount;
                    const rotateAmount = (distX > 0) ? -8 : 8;
                    chicken.style.transform = `translate(${dodgeX}px, ${dodgeY}px) rotate(${rotateAmount}deg)`;
                }
            }, 200);
            
            setTimeout(() => {
                chicken.classList.remove('wiggle');
            }, 300);
        }

        function createParticles(x, y) {
            const particles = ['', '', '', '', ''];
            const numParticles = 5;
            
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                particle.style.left = x + (Math.random() - 0.5) * 100 + 'px';
                particle.style.top = y + (Math.random() - 0.5) * 100 + 'px';
                document.body.appendChild(particle);
                
                setTimeout(() => particle.remove(), 1000);
            }
        }

        // Placeholder for blockchain integration
        function grabChickenBlockchain() {
            console.log(' Grab chicken function called!');
            console.log('Ready for smart contract integration...');
            // Your blockchain logic here
        }

        // ====== WEB3 INTEGRATION ======
        let web3;
        let userAccount;
        let chickenContract;
        let tokenContract;

        // Contract addresses
        const CHICKEN_CONTRACT_ADDRESS = '0xD098f20E494a0fb926d9D8bf7330486bcfDB9913';
        const TOKEN_CONTRACT_ADDRESS = '0xb7C10146bA1b618956a38605AB6496523d450871'; // ESHARE on Base
        const OWNER_ADDRESS = '0x8be2544CB620C5b4B9f1dA7cc80E51B7d093Eee0'; // Owner wallet - update this to your address
        const BASE_CHAIN_ID = '0x2105'; // Base network chain ID (8453 in hex)

        // Contract ABIs
        const CHICKEN_ABI = [
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"grabChicken","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"startRound","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"depositSeed","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"chickenHolder","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"currentMinGrab","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getCurrentRound","outputs":[{"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"uint256","name":"pot","type":"uint256"},{"internalType":"address","name":"holder","type":"address"},{"internalType":"uint256","name":"minGrab","type":"uint256"},{"internalType":"uint256","name":"blocksLeft","type":"uint256"},{"internalType":"uint256","name":"participants","type":"uint256"},{"internalType":"uint256","name":"grabs","type":"uint256"},{"internalType":"bool","name":"isHotZone","type":"bool"},{"internalType":"uint256","name":"hzDeposits","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getTimeLeft","outputs":[{"internalType":"uint256","name":"blocks","type":"uint256"},{"internalType":"uint256","name":"secs","type":"uint256"},{"internalType":"bool","name":"isHZ","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"currentRound","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"round","type":"uint256"}],"name":"getParticipants","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"round","type":"uint256"}],"name":"getRoundInfo","outputs":[{"internalType":"uint256","name":"pot","type":"uint256"},{"internalType":"uint256","name":"seed","type":"uint256"},{"internalType":"uint256","name":"playerDeps","type":"uint256"},{"internalType":"uint256","name":"hzDeps","type":"uint256"},{"internalType":"address","name":"loser","type":"address"},{"internalType":"uint256","name":"loserDeps","type":"uint256"},{"internalType":"bool","name":"settled","type":"bool"},{"internalType":"uint256","name":"burned","type":"uint256"},{"internalType":"uint256","name":"lottoPrize","type":"uint256"},{"internalType":"address","name":"lottoWinner","type":"address"},{"internalType":"uint256","name":"hzBonus","type":"uint256"},{"internalType":"uint256","name":"mainPool","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"address","name":"player","type":"address"}],"name":"getPlayerRound","outputs":[{"internalType":"uint256","name":"deps","type":"uint256"},{"internalType":"uint256","name":"hzDeps","type":"uint256"},{"internalType":"uint256","name":"grabs","type":"uint256"},{"internalType":"bool","name":"isLoser","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"}],"name":"deposits","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"totalBurned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getSeedVaultInfo","outputs":[{"internalType":"uint256","name":"vaultBalance","type":"uint256"},{"internalType":"uint256","name":"amountPerRound","type":"uint256"},{"internalType":"uint256","name":"roundsRemaining","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"roundSeedAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"seedVault","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"val","type":"uint256"}],"name":"setBaseTimerBlocks","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"val","type":"uint256"}],"name":"setMinGrabCost","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"setRoundSeedAmount","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"pot","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"nextMinGrab","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"blocksLeft","type":"uint256"},{"indexed":false,"internalType":"bool","name":"isHotZone","type":"bool"}],"name":"ChickenGrabbed","type":"event"}
        ];

        const TOKEN_ABI = [
            {
                "inputs": [
                    {"internalType": "address", "name": "spender", "type": "address"},
                    {"internalType": "uint256", "name": "amount", "type": "uint256"}
                ],
                "name": "approve",
                "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "owner", "type": "address"},
                    {"internalType": "address", "name": "spender", "type": "address"}
                ],
                "name": "allowance",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        const connectWalletBtn = document.getElementById('connectWallet');
        const amountContainer = document.getElementById('amountContainer');
        const balanceContainer = document.getElementById('balanceContainer');
        const balanceValue = document.getElementById('balanceValue');
        const eshareAmountInput = document.getElementById('eshareAmount');
        const currentHolderEl = document.getElementById('currentHolder');
        const previousHoldersEl = document.getElementById('previousHolders');

        // Minimum cost required to grab chicken (starts at 0.10, then +10% each time)
        let minimumCost = 0.10; // Default for first player
        let lastGrabAmount = 0; // Track last grab amount

        // Calculate minimum cost from contract
        async function updateMinimumCost() {
            try {
                if (chickenContract) {
                    // Get current round info including minimum grab amount
                    const roundInfo = await chickenContract.methods.getCurrentRound().call();
                    const minGrabWei = roundInfo.minGrab;
                    const blocksLeft = parseInt(roundInfo.blocksLeft);
                    
                    // If blocksLeft is 0, the round has ended - use base minimum for new round
                    if (blocksLeft === 0) {
                        minimumCost = 0.001; // Base minimum for new round
                        console.log('Round ended (blocksLeft=0), using base minimum:', minimumCost);
                    } else if (minGrabWei && minGrabWei !== '0') {
                        minimumCost = parseFloat(web3.utils.fromWei(minGrabWei, 'ether'));
                    } else {
                        // No active round or first grab - use base minimum
                        minimumCost = 0.001;
                    }
                } else {
                    // Contract not connected yet - default to base minimum
                    minimumCost = 0.001;
                }
                
                // Auto-fill the input with the minimum required amount
                const inputBox = document.getElementById('eshareAmount');
                if (inputBox) {
                    inputBox.value = minimumCost.toFixed(4);
                    inputBox.placeholder = minimumCost.toFixed(4);
                }
            } catch (error) {
                console.error('Error getting minimum cost:', error);
                minimumCost = 0.001;
                const inputBox = document.getElementById('eshareAmount');
                if (inputBox) {
                    inputBox.value = minimumCost.toFixed(4);
                }
            }
        }

        // Check if input is below minimum and style accordingly
        eshareAmountInput.addEventListener('input', function() {
            const amount = parseFloat(this.value) || 0;
            if (amount < minimumCost) {
                this.classList.add('below-minimum');
            } else {
                this.classList.remove('below-minimum');
            }
        });

        // Initialize with minimum cost
        updateMinimumCost();

        // Initialize
        window.addEventListener('load', async () => {
            console.log('Page loaded');
            console.log('Ethereum detected:', typeof window.ethereum !== 'undefined');
            console.log('Connect button:', connectWalletBtn);
            
            if (typeof window.ethereum !== 'undefined') {
                console.log('Adding click listener to connect button');
                connectWalletBtn.addEventListener('click', connectWallet);
                
                // Listen for account changes
                window.ethereum.on('accountsChanged', async (accounts) => {
                    console.log('Account changed:', accounts);
                    if (accounts.length > 0) {
                        // User switched accounts - reconnect
                        await connectWallet();
                    } else {
                        // User disconnected - reload page
                        location.reload();
                    }
                });
                
                // Listen for chain changes
                window.ethereum.on('chainChanged', () => {
                    // Reload page on chain change
                    location.reload();
                });
            } else {
                console.log('No wallet detected - showing install message');
                connectWalletBtn.textContent = 'Install Wallet';
            }

            // Load leaderboard data always (not just when contracts are set)
            loadLeaderboard();
            loadPreviousWinners();
        });

        // Network checking function
        async function checkAndSwitchNetwork() {
            try {
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                
                if (chainId !== BASE_CHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: BASE_CHAIN_ID }],
                        });
                    } catch (switchError) {
                        // Chain not added to MetaMask
                        if (switchError.code === 4902) {
                            try {
                                await window.ethereum.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [{
                                        chainId: BASE_CHAIN_ID,
                                        chainName: 'Base',
                                        nativeCurrency: {
                                            name: 'Ethereum',
                                            symbol: 'ETH',
                                            decimals: 18
                                        },
                                        rpcUrls: ['https://mainnet.base.org'],
                                        blockExplorerUrls: ['https://basescan.org']
                                    }]
                                });
                            } catch (addError) {
                                throw new Error('Please add Base network to MetaMask');
                            }
                        }
                        throw switchError;
                    }
                }
            } catch (error) {
                console.error('Network switch error:', error);
                alert('Please switch to Base network in MetaMask to use this app!');
                throw error;
            }
        }

        async function connectWallet() {
            console.log('Connect wallet clicked!');
                await checkAndSwitchNetwork();
            try {
                web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = accounts[0];

                chickenContract = new web3.eth.Contract(CHICKEN_ABI, CHICKEN_CONTRACT_ADDRESS);
                tokenContract = new web3.eth.Contract(TOKEN_ABI, TOKEN_CONTRACT_ADDRESS);

                // Play connect sound - simple beep
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800; // Frequency in hertz
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                } catch (e) {
                    console.log('Audio play failed:', e);
                }

                // Show connected address
                document.getElementById('connectedWallet').style.display = 'flex';
                document.getElementById('connectedAddress').textContent = formatAddress(userAccount);

                // Show owner dashboard if owner
                if (userAccount.toLowerCase() === OWNER_ADDRESS.toLowerCase()) {
                    document.getElementById('ownerDashboard').style.display = 'block';
                }

                // Transform button into grab chicken button
                connectWalletBtn.classList.add('is-grab-button');
                connectWalletBtn.textContent = ' GRAB CHICKEN ';
                connectWalletBtn.removeEventListener('click', connectWallet);
                connectWalletBtn.addEventListener('click', handleGrabChicken);

                loadLeaderboard();
                loadBalance();
                loadPreviousWinners(); // Load previous winners after wallet connects
                updateMinimumCost(); // Update minimum cost from contract
                updateGameInfo(); // Update timer, seed, pool
            } catch (error) {
                console.error('Error connecting wallet:', error);
                alert('Failed to connect wallet');
            }
        }

        // Seed Modal handlers
        document.getElementById('openSeedModal').addEventListener('click', () => {
            if (!userAccount) {
                alert('Please connect your wallet first');
                return;
            }
            document.getElementById('seedModalOverlay').classList.add('show');
        });

        document.getElementById('seedModalCancel').addEventListener('click', () => {
            document.getElementById('seedModalOverlay').classList.remove('show');
        });

        document.getElementById('seedModalOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('seedModalOverlay')) {
                document.getElementById('seedModalOverlay').classList.remove('show');
            }
        });

        document.getElementById('seedModalConfirm').addEventListener('click', handleDepositSeed);

        async function handleDepositSeed() {
            if (!userAccount) {
                alert('Please connect your wallet first');
                return;
            }

            try {
                const seedAmountEshare = parseFloat(document.getElementById('seedModalAmount').value);
                if (isNaN(seedAmountEshare) || seedAmountEshare <= 0) {
                    alert('Please enter a valid seed amount');
                    return;
                }

                const confirmBtn = document.getElementById('seedModalConfirm');
                confirmBtn.disabled = true;
                confirmBtn.textContent = 'Approving...';

                const requiredAmount = web3.utils.toWei(seedAmountEshare.toString(), 'ether');

                // Check allowance
                const allowance = await tokenContract.methods.allowance(userAccount, CHICKEN_CONTRACT_ADDRESS).call();

                if (BigInt(allowance) < BigInt(requiredAmount)) {
                    // Need approval
                    const approveTx = await tokenContract.methods.approve(
                        CHICKEN_CONTRACT_ADDRESS,
                        requiredAmount
                    ).send({ from: userAccount });

                    console.log('Approval tx:', approveTx);
                    
                    // 2 second delay before next transaction
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }

                confirmBtn.textContent = 'Depositing...';

                // Call depositSeed
                const depositTx = await chickenContract.methods.depositSeed(requiredAmount).send({ from: userAccount });
                console.log('Deposit seed tx:', depositTx);

                confirmBtn.textContent = ' Done!';

                // Reload everything and close modal
                setTimeout(() => {
                    loadLeaderboard();
                    loadBalance();
                    updateGameInfo();
                    confirmBtn.textContent = 'Deposit';
                    confirmBtn.disabled = false;
                    document.getElementById('seedModalOverlay').classList.remove('show');
                }, 1500);

            } catch (error) {
                console.error('Error depositing seed:', error);
                alert('Error depositing seed: ' + (error.message || 'Unknown error'));
                const confirmBtn = document.getElementById('seedModalConfirm');
                confirmBtn.textContent = 'Deposit';
                confirmBtn.disabled = false;
            }
        }

        // Owner Dashboard Handlers
        document.getElementById('setTimerBlocksBtn').addEventListener('click', async () => {
            if (!userAccount || userAccount.toLowerCase() !== OWNER_ADDRESS.toLowerCase()) {
                alert('Owner only');
                return;
            }
            const btn = document.getElementById('setTimerBlocksBtn');
            const value = parseInt(document.getElementById('ownerTimerBlocks').value);
            if (isNaN(value) || value < 1) {
                alert('Please enter a valid number of blocks');
                return;
            }
            try {
                btn.disabled = true;
                btn.textContent = '...';
                await chickenContract.methods.setBaseTimerBlocks(value).send({ from: userAccount });
                btn.textContent = '';
                setTimeout(() => { btn.textContent = 'Set'; btn.disabled = false; }, 1500);
            } catch (error) {
                console.error('Error setting timer blocks:', error);
                alert('Error: ' + (error.message || 'Unknown error'));
                btn.textContent = 'Set';
                btn.disabled = false;
            }
        });

        document.getElementById('setMinGrabBtn').addEventListener('click', async () => {
            if (!userAccount || userAccount.toLowerCase() !== OWNER_ADDRESS.toLowerCase()) {
                alert('Owner only');
                return;
            }
            const btn = document.getElementById('setMinGrabBtn');
            const value = parseFloat(document.getElementById('ownerMinGrab').value);
            if (isNaN(value) || value <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            try {
                btn.disabled = true;
                btn.textContent = '...';
                const weiValue = web3.utils.toWei(value.toString(), 'ether');
                await chickenContract.methods.setMinGrabCost(weiValue).send({ from: userAccount });
                btn.textContent = '';
                setTimeout(() => { btn.textContent = 'Set'; btn.disabled = false; updateMinimumCost(); }, 1500);
            } catch (error) {
                console.error('Error setting min grab:', error);
                alert('Error: ' + (error.message || 'Unknown error'));
                btn.textContent = 'Set';
                btn.disabled = false;
            }
        });

        document.getElementById('setSeedAmountBtn').addEventListener('click', async () => {
            if (!userAccount || userAccount.toLowerCase() !== OWNER_ADDRESS.toLowerCase()) {
                alert('Owner only');
                return;
            }
            const btn = document.getElementById('setSeedAmountBtn');
            const value = parseFloat(document.getElementById('ownerSeedAmount').value);
            if (isNaN(value) || value <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            try {
                btn.disabled = true;
                btn.textContent = '...';
                const weiValue = web3.utils.toWei(value.toString(), 'ether');
                await chickenContract.methods.setRoundSeedAmount(weiValue).send({ from: userAccount });
                btn.textContent = '';
                setTimeout(() => { btn.textContent = 'Set'; btn.disabled = false; updateGameInfo(); }, 1500);
            } catch (error) {
                console.error('Error setting seed amount:', error);
                alert('Error: ' + (error.message || 'Unknown error'));
                btn.textContent = 'Set';
                btn.disabled = false;
            }
        });

        async function handleGrabChicken() {
            if (!userAccount) return;

            try {
                // Get amount from input
                const amountEshare = parseFloat(eshareAmountInput.value);
                if (isNaN(amountEshare) || amountEshare < minimumCost) {
                    alert(`Please enter at least ${minimumCost.toFixed(4)} ESHARE`);
                    return;
                }

                // Get current round info to verify
                const roundInfo = await chickenContract.methods.getCurrentRound().call();
                console.log('Current round before grab:', roundInfo);
                console.log('Round active?', roundInfo.round > 0);
                
                const requiredAmount = web3.utils.toWei(amountEshare.toString(), 'ether');

                console.log('Min grab required (wei):', roundInfo.minGrab);
                console.log('Amount we are sending (wei):', requiredAmount);

                connectWalletBtn.disabled = true;
                connectWalletBtn.textContent = 'APPROVING...';

                // Check allowance
                const allowance = await tokenContract.methods.allowance(userAccount, CHICKEN_CONTRACT_ADDRESS).call();

                console.log('Allowance:', allowance);
                console.log('Required:', requiredAmount);

                if (BigInt(allowance) < BigInt(requiredAmount)) {
                    // Need approval - approve exact amount needed
                    const approveTx = await tokenContract.methods.approve(
                        CHICKEN_CONTRACT_ADDRESS,
                        requiredAmount // Exact amount, not large approval
                    ).send({ from: userAccount });

                    console.log('Approval tx:', approveTx);
                    
                    // 2 second delay before next transaction
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }

                connectWalletBtn.textContent = 'GRABBING...';

                // Call grabChicken with amount
                console.log('Calling grabChicken with amount:', requiredAmount);
                const grabTx = await chickenContract.methods.grabChicken(requiredAmount).send({ from: userAccount });
                console.log('Grab tx:', grabTx);

                // Get chicken element for animations
                const chicken = document.querySelector('.chicken');
                
                // Trigger visual effects
                const rect = chicken.getBoundingClientRect();
                playChickenAnimation({
                    clientX: rect.left + rect.width / 2,
                    clientY: rect.top + rect.height / 2
                });

                // Reset game over state (in case this started a new round)
                chicken.classList.remove('exploded');
                chicken.classList.remove('hotzone'); // Remove hotzone on new grab
                
                // Explicitly reset chicken visual state
                chicken.style.opacity = '1';
                chicken.style.transform = '';
                chicken.style.animation = '';
                
                document.getElementById('gameOverMessage').classList.remove('show');
                document.getElementById('hotzone Smoke').classList.remove('active');
                document.getElementById('hotzoneLeft').classList.remove('active');
                document.getElementById('hotzoneRight').classList.remove('active');

                connectWalletBtn.textContent = ' GRAB CHICKEN ';
                connectWalletBtn.disabled = false;

                // Force timer reset - reset all timer state to trigger reload
                displayedSeconds = null;
                serverSecondsAtFetch = null;
                fetchTimestamp = null;
                lastBlockFetchTime = 0;
                fetchInProgress = false;
                
                // Small initial delay to let blockchain update
                setTimeout(() => {
                    loadLeaderboard();
                    loadBalance();
                    loadPreviousWinners();
                    updateMinimumCost();
                    updateGameInfo();
                }, 500);
                
                // Continue aggressive refreshing for blockchain sync
                setTimeout(() => {
                    loadLeaderboard();
                    loadPreviousWinners();
                    updateMinimumCost();
                    updateGameInfo();
                }, 2000);
                
                setTimeout(() => {
                    loadLeaderboard();
                    loadPreviousWinners();
                    updateMinimumCost();
                    updateGameInfo();
                }, 4000);
                
                setTimeout(() => {
                    loadLeaderboard();
                    loadPreviousWinners();
                    updateGameInfo();
                }, 6000);
                
                setTimeout(() => {
                    loadLeaderboard();
                    loadPreviousWinners();
                }, 8000);
                
                setTimeout(() => {
                    loadLeaderboard();
                }, 10000);
                
                setTimeout(() => {
                    loadLeaderboard();
                    updateGameInfo();
                }, 5000);

            } catch (error) {
                console.error('Error grabbing chicken:', error);
                alert('Failed to grab chicken: ' + error.message);
                connectWalletBtn.textContent = ' GRAB CHICKEN ';
                connectWalletBtn.disabled = false;
            }
        }

        async function loadBalance() {
            if (!tokenContract || !userAccount) return;
            
            try {
                console.log('Loading balance for:', userAccount);
                console.log('Token contract address:', TOKEN_CONTRACT_ADDRESS);
                console.log('Token contract:', tokenContract);
                
                const balance = await tokenContract.methods.balanceOf(userAccount).call();
                console.log('Balance (wei):', balance);
                const balanceFormatted = (parseFloat(web3.utils.fromWei(balance, 'ether'))).toFixed(4);
                balanceValue.textContent = `${balanceFormatted} ESHARE`;
            } catch (error) {
                console.error('Error loading balance:', error);
                balanceValue.textContent = '0.00 ESHARE (error loading)';
            }
        }

        // Timer ticker variables - IMPROVED with real timestamp tracking
        let tickerInterval = null;
        let displayedSeconds = null;
        let serverSecondsAtFetch = null;  // Seconds from server at last fetch
        let fetchTimestamp = null;        // When we fetched from server (Date.now())
        let fetchInProgress = false;
        let lastBlockFetchTime = 0;
        let lastRoundEndBlock = 0;
        let isHotzoneFromServer = false;
        const FETCH_INTERVAL_MS = 5000; // Fetch from blockchain every 5 seconds
        const BLOCK_TIME_SEC = 2; // Base blocks are ~2 seconds

        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return "00h : 00m : 00s";
            const s = Math.max(0, Math.floor(seconds));
            const h = Math.floor(s / 3600);
            const m = Math.floor((s % 3600) / 60);
            const sec = s % 60;
            return `${String(h).padStart(2, "0")}h : ${String(m).padStart(2, "0")}m : ${String(sec).padStart(2, "0")}s`;
        }
        
        // Calculate current display time based on real elapsed time since last fetch
        // This ensures timer stays accurate even when tab is backgrounded
        function calculateCurrentSeconds() {
            if (serverSecondsAtFetch === null || fetchTimestamp === null) {
                return displayedSeconds ?? 0;
            }
            const elapsedMs = Date.now() - fetchTimestamp;
            const elapsedSec = Math.floor(elapsedMs / 1000);
            return Math.max(0, serverSecondsAtFetch - elapsedSec);
        }
        
        // Handle tab visibility changes - resync timer immediately when returning to tab
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && chickenContract) {
                console.log('Tab became visible - resyncing timer immediately...');
                // Force immediate refetch by resetting last fetch time
                lastBlockFetchTime = 0;
                fetchInProgress = false;
                // Also immediately recalculate display based on existing data
                displayedSeconds = calculateCurrentSeconds();
                document.getElementById('timer').textContent = formatTime(displayedSeconds);
            }
        });

        function triggerGameOver() {
            console.log('Game Over!');
            
            // Explode the chicken
            const chicken = document.querySelector('.chicken');
            chicken.classList.add('exploded');
            
            // Create feather explosion
            createFeathers();
            
            // Show game over message
            setTimeout(() => {
                document.getElementById('gameOverMessage').classList.add('show');
            }, 500);
            
            // Reset input to default minimum for new round
            minimumCost = 0.001;
            const inputBox = document.getElementById('eshareAmount');
            if (inputBox) {
                inputBox.value = '0.0010';
                inputBox.placeholder = '0.0010';
                console.log('Reset input box to 0.0010 for new round');
            }
            console.log('Reset minimum cost to 0.001 for new round');
            
            // After a delay, refresh the minimum cost from contract (in case new round started)
            setTimeout(() => {
                updateMinimumCost();
                loadLeaderboard();
                loadPreviousWinners();
                updateGameInfo();
            }, 2000);
            
            // Keep checking for new round every 5 seconds
            const checkNewRound = setInterval(async () => {
                try {
                    await updateMinimumCost();
                    // If minimum cost changed, a new round started
                    if (minimumCost > 0.001) {
                        clearInterval(checkNewRound);
                        console.log('New round detected, minimum cost:', minimumCost);
                    }
                } catch (e) {
                    console.log('Error checking new round:', e);
                }
            }, 5000);
            
            // Stop checking after 2 minutes
            setTimeout(() => clearInterval(checkNewRound), 120000);
        }

        function createFeathers() {
            const chickenArea = document.querySelector('.chicken-area');
            const featherEmojis = ['', '', '', ''];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const feather = document.createElement('div');
                    feather.className = 'feathers';
                    feather.textContent = featherEmojis[Math.floor(Math.random() * featherEmojis.length)];
                    feather.style.left = (Math.random() * 80 + 10) + '%';
                    feather.style.top = '50%';
                    chickenArea.appendChild(feather);
                    
                    setTimeout(() => feather.remove(), 3000);
                }, i * 100);
            }
        }

        function startTicker() {
            if (tickerInterval) clearInterval(tickerInterval);
            
            let lastLeaderboardRefresh = 0;
            const LEADERBOARD_REFRESH_MS = 5000; // Refresh leaderboard every 5 seconds
            let lastKnownRound = 0; // Track round changes
            
            tickerInterval = setInterval(async () => {
                try {
                    const now = Date.now();
                    
                    if (!chickenContract) return;
                    
                    // Refresh leaderboard periodically
                    if (now - lastLeaderboardRefresh >= LEADERBOARD_REFRESH_MS) {
                        lastLeaderboardRefresh = now;
                        loadLeaderboard();
                        
                        // Also check for round change and update minimum cost
                        try {
                            const currentRound = await chickenContract.methods.currentRound().call();
                            const roundNum = parseInt(currentRound);
                            
                            if (lastKnownRound > 0 && roundNum !== lastKnownRound) {
                                console.log('Round changed from', lastKnownRound, 'to', roundNum, '- resetting game state');
                                
                                // Reset chicken from exploded state
                                const chicken = document.querySelector('.chicken');
                                chicken.classList.remove('exploded');
                                chicken.classList.remove('hotzone');
                                chicken.style.opacity = '1';
                                chicken.style.transform = '';
                                chicken.style.animation = '';
                                document.getElementById('gameOverMessage').classList.remove('show');
                                document.getElementById('hotzone Smoke').classList.remove('active');
                                document.getElementById('hotzoneLeft').classList.remove('active');
                                document.getElementById('hotzoneRight').classList.remove('active');
                                
                                // Reset timer state for new round
                                displayedSeconds = null;
                                serverSecondsAtFetch = null;
                                fetchTimestamp = null;
                                
                                // Round changed - reset and update minimum
                                await updateMinimumCost();
                                loadPreviousWinners();
                                updateGameInfo();
                            }
                            lastKnownRound = roundNum;
                        } catch (e) {
                            console.log('Error checking round:', e);
                        }
                    }
                    
                    // Fetch time left periodically from blockchain (non-blocking)
                    if (!fetchInProgress && (now - lastBlockFetchTime >= FETCH_INTERVAL_MS)) {
                        fetchInProgress = true;
                        lastBlockFetchTime = now;
                        
                        chickenContract.methods.getTimeLeft().call().then(timeLeft => {
                            const secs = parseInt(timeLeft.secs);
                            const isHZ = timeLeft.isHZ;
                            
                            // Store the server time and when we fetched it
                            serverSecondsAtFetch = secs;
                            fetchTimestamp = Date.now();
                            isHotzoneFromServer = isHZ;
                            
                            // Check for new round (timer went from 0 to positive)
                            const wasAtZero = displayedSeconds === 0 || displayedSeconds === null;
                            
                            if (wasAtZero && secs > 0) {
                                // New round started - reset chicken
                                const chicken = document.querySelector('.chicken');
                                if (chicken.classList.contains('exploded')) {
                                    console.log('New round detected - resetting chicken from exploded state');
                                    chicken.classList.remove('exploded');
                                    chicken.classList.remove('hotzone');
                                    chicken.style.opacity = '1';
                                    chicken.style.transform = '';
                                    chicken.style.animation = '';
                                    document.getElementById('gameOverMessage').classList.remove('show');
                                    document.getElementById('hotzone Smoke').classList.remove('active');
                                    document.getElementById('hotzoneLeft').classList.remove('active');
                                    document.getElementById('hotzoneRight').classList.remove('active');
                                }
                            }
                            
                            // Update hot zone timer class
                            if (isHZ) {
                                document.getElementById('timer').classList.add('hot-zone');
                            } else {
                                document.getElementById('timer').classList.remove('hot-zone');
                            }
                            
                            fetchInProgress = false;
                        }).catch(() => {
                            fetchInProgress = false;
                        });
                    }
                    
                    // Calculate display time based on real elapsed time (not interval ticks!)
                    // This ensures accuracy even when tab is backgrounded
                    displayedSeconds = calculateCurrentSeconds();
                    
                    // Check if timer hit zero - trigger game over
                    if (displayedSeconds === 0 && serverSecondsAtFetch !== null && !document.querySelector('.chicken').classList.contains('exploded')) {
                        triggerGameOver();
                    }
                    
                    // Hot Zone detection (5 minutes or less = 300 seconds)
                    const chicken = document.querySelector('.chicken');
                    const hotzoneSmoke = document.getElementById('hotzone Smoke');
                    const hotzoneLeft = document.getElementById('hotzoneLeft');
                    const hotzoneRight = document.getElementById('hotzoneRight');
                    
                    // Only show hotzone if we have valid time AND it's <= 300 seconds (5 minutes)
                    const shouldBeHotzone = displayedSeconds !== null && displayedSeconds > 0 && displayedSeconds <= 300;
                    
                    // Debug logging
                    if (displayedSeconds !== null && displayedSeconds <= 350 && displayedSeconds > 280) {
                        console.log('Near hotzone threshold - displayedSeconds:', displayedSeconds, 'shouldBeHotzone:', shouldBeHotzone);
                    }
                    
                    if (shouldBeHotzone) {
                        // Entering hot zone
                        if (!chicken.classList.contains('hotzone')) {
                            chicken.classList.add('hotzone');
                            hotzoneSmoke.classList.add('active');
                            hotzoneLeft.classList.add('active');
                            hotzoneRight.classList.add('active');
                            console.log(' HOTZONE ACTIVATED at', displayedSeconds, 'seconds!');
                        }
                    } else {
                        // NOT in hot zone - remove all effects
                        chicken.classList.remove('hotzone');
                        hotzoneSmoke.classList.remove('active');
                        hotzoneLeft.classList.remove('active');
                        hotzoneRight.classList.remove('active');
                    }
                    
                    document.getElementById('timer').textContent = formatTime(displayedSeconds ?? 0);
                    
                } catch (e) {
                    console.warn("Ticker error:", e);
                }
            }, 1000);
        }

        async function updateGameInfo() {
            try {
                if (chickenContract) {
                    const roundInfo = await chickenContract.methods.getCurrentRound().call();
                    
                    // Update seed (from current round's actual seed)
                    if (roundInfo.round > 0) {
                        const detailedInfo = await chickenContract.methods.getRoundInfo(roundInfo.round).call();
                        const seedEshare = parseFloat(web3.utils.fromWei(detailedInfo.seed, 'ether'));
                        document.getElementById('seedEshare').innerHTML = seedEshare.toFixed(4) + ' <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                        
                        // Calculate actual pool from player deposits
                        const playerDepositsEshare = parseFloat(web3.utils.fromWei(detailedInfo.playerDeps, 'ether'));
                        document.getElementById('poolEshare').innerHTML = playerDepositsEshare.toFixed(4) + ' <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                    } else {
                        document.getElementById('seedEshare').innerHTML = '0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                        document.getElementById('poolEshare').innerHTML = '0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                    }
                    
                    // Update seed vault info in actions box
                    try {
                        const vaultInfo = await chickenContract.methods.getSeedVaultInfo().call();
                        const vaultBalance = parseFloat(web3.utils.fromWei(vaultInfo.vaultBalance, 'ether'));
                        document.getElementById('vaultBalance').textContent = vaultBalance.toFixed(2);
                    } catch (e) {
                        console.log('Error getting vault info:', e);
                        document.getElementById('vaultBalance').textContent = '0.00';
                    }
                    
                    // Update total burnt
                    try {
                        const totalBurnt = await chickenContract.methods.totalBurned().call();
                        const burntEshare = parseFloat(web3.utils.fromWei(totalBurnt, 'ether'));
                        document.getElementById('totalBurnt').textContent = burntEshare.toFixed(3);
                    } catch (e) {
                        console.log('Error getting total burnt:', e);
                        document.getElementById('totalBurnt').textContent = '0.000';
                    }
                    
                    // Start the ticker if not already running
                    if (!tickerInterval) {
                        startTicker();
                    }
                }
            } catch (error) {
                console.log('Error updating game info:', error);
            }
        }

        async function loadLeaderboard() {
            try {
                // Get current round info
                if (chickenContract) {
                    const roundInfo = await chickenContract.methods.getCurrentRound().call();
                    const currentRoundNum = roundInfo.round;
                    const holder = roundInfo.holder;
                    
                    // Get accurate pot from playerDeps
                    let actualPot = roundInfo.pot;
                    if (currentRoundNum > 0) {
                        const detailedInfo = await chickenContract.methods.getRoundInfo(currentRoundNum).call();
                        actualPot = detailedInfo.playerDeps; // Use playerDeps as the actual pot
                    }
                    
                    console.log('Round info:', roundInfo);
                    console.log('Actual pot (playerDeps):', actualPot);
                    
                    // Update current holder and their deposit
                    if (holder && holder !== '0x0000000000000000000000000000000000000000') {
                        currentHolderEl.textContent = formatAddress(holder);
                        
                        // Get the holder's individual deposit using deposits mapping
                        try {
                            const holderDeposit = await chickenContract.methods.deposits(currentRoundNum, holder).call();
                            const depositEshare = parseFloat(web3.utils.fromWei(holderDeposit, 'ether'));
                            document.getElementById('currentAmount').innerHTML = depositEshare.toFixed(4) + ' <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                            
                            // Calculate lead plucker potential winnings (gets FULL seed TAX FREE as consolation)
                            try {
                                const roundDetails = await chickenContract.methods.getRoundInfo(currentRoundNum).call();
                                const seedAmount = parseFloat(web3.utils.fromWei(roundDetails.seed, 'ether'));
                                
                                // Seed is TAX FREE - loser gets full amount as consolation
                                console.log('Lead plucker seed winnings (TAX FREE):', seedAmount);
                                
                                document.getElementById('currentWinnings').innerHTML = seedAmount.toFixed(4) + ' <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                            } catch (e) {
                                console.log('Error calculating holder winnings:', e);
                                document.getElementById('currentWinnings').innerHTML = '0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                            }
                        } catch (e) {
                            console.log('Error getting holder deposit:', e);
                            document.getElementById('currentAmount').innerHTML = '0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                            document.getElementById('currentWinnings').innerHTML = '0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                        }
                    } else {
                        currentHolderEl.textContent = 'No holder yet';
                        document.getElementById('currentAmount').innerHTML = '0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                        document.getElementById('currentWinnings').innerHTML = '0.0000 <img src="eshare-logo.png" class="eshare-symbol" alt="E">';
                    }
                    
                    // Get participants for past pluckers
                    if (currentRoundNum > 0) {
                        try {
                            // Use getParticipants to get all participants
                            const participants = await chickenContract.methods.getParticipants(currentRoundNum).call();
                            
                            console.log('Participants:', participants);
                            
                            // Check if we have participants
                            if (!participants || participants.length === 0) {
                                previousHoldersEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">No participants yet</div>';
                            } else {
                                // Fetch deposits for each participant
                                const participantsWithDeposits = await Promise.all(
                                    participants.map(async (addr) => {
                                        const deposit = await chickenContract.methods.deposits(currentRoundNum, addr).call();
                                        return { address: addr, deposit };
                                    })
                                );
                                
                                console.log('Participants with deposits:', participantsWithDeposits);
                                
                                // Lead Plucker = current holder (shown separately above)
                                // Everyone else sorted by total bids (deposits) descending
                                const pastPluckers = [...participantsWithDeposits]
                                    .filter(p => p.address.toLowerCase() !== holder.toLowerCase())
                                    .sort((a, b) => {
                                        // Sort by deposit descending (highest bids first)
                                        if (BigInt(b.deposit) > BigInt(a.deposit)) return 1;
                                        if (BigInt(b.deposit) < BigInt(a.deposit)) return -1;
                                        return 0;
                                    })
                                    .slice(0, 9);
                                
                                console.log('Past pluckers (sorted by deposits):', pastPluckers.map(p => ({addr: p.address, deposit: p.deposit})));
                                
                                // Calculate total deposits of past pluckers for pot distribution
                                const totalPastDeposits = pastPluckers.reduce((sum, p) => sum + BigInt(p.deposit), BigInt(0));
                                const potEshare = parseFloat(web3.utils.fromWei(actualPot, 'ether'));
                                
                                // NEW TAX STRUCTURE: All participants pay 11% tax (5% burn + 1% owner + 5% lotto)
                                // Winners get 89% of their deposit back, plus their share of chicken's contribution
                                const afterTaxMultiplier = 0.89; // 89% after 11% tax
                                console.log('Tax multiplier:', afterTaxMultiplier, '(11% tax on all participants)');
                                
                                if (pastPluckers.length > 0) {
                                    previousHoldersEl.innerHTML = pastPluckers.map((plucker, index) => {
                                        const isUserConnected = userAccount && plucker.address.toLowerCase() === userAccount.toLowerCase();
                                        const userClass = isUserConnected ? ' user-connected' : '';
                                        const depositEshare = parseFloat(web3.utils.fromWei(plucker.deposit, 'ether'));
                                        
                                        // Calculate this player's share of the pot based on their deposit proportion
                                        // They get their deposit back (minus 11% tax) + share of chicken's contribution
                                        let potentialWinnings = 0;
                                        if (totalPastDeposits > BigInt(0)) {
                                            const depositShare = Number(BigInt(plucker.deposit) * BigInt(10000) / totalPastDeposits) / 10000;
                                            const grossWinnings = potEshare * depositShare;
                                            potentialWinnings = grossWinnings * afterTaxMultiplier; // Apply taxes
                                        }
                                        
                                        return `
                                        <div class="holder-item${userClass}">
                                            <span class="holder-rank">#${index + 2}</span>
                                            <span class="holder-address">${formatAddress(plucker.address)}</span>
                                            <span class="holder-amount">${depositEshare.toFixed(4)} <img src="eshare-logo.png" class="eshare-symbol" alt="E"></span>
                                            <span class="holder-winnings">${potentialWinnings.toFixed(4)} <img src="eshare-logo.png" class="eshare-symbol" alt="E"></span>
                                        </div>
                                        `;
                                    }).join('');
                                } else {
                                    previousHoldersEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">... awaiting more pluckers ...</div>';
                                }
                            }
                        } catch (e) {
                            console.error('Error getting leaderboard:', e);
                            previousHoldersEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">Error loading leaderboard</div>';
                        }
                    } else {
                        previousHoldersEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">No round active - be the first to grab!</div>';
                    }
                } else {
                    // No contract - show defaults
                    currentHolderEl.textContent = 'Connect wallet';
                    previousHoldersEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">Connect wallet to see leaderboard</div>';
                }

                // Check if scroll indicator should be shown (with slight delay for DOM update)
                setTimeout(checkScrollIndicator, 100);

            } catch (error) {
                console.error('Error loading leaderboard:', error);
                currentHolderEl.textContent = 'Error loading';
                previousHoldersEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">Error loading data</div>';
            }
        }

        // Load previous winners (settled rounds)
        async function loadPreviousWinners() {
            const winnersListEl = document.getElementById('previousWinnersList');
            
            if (!chickenContract) {
                winnersListEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">Connect wallet to see previous winners</div>';
                return;
            }

            try {
                const currentRoundNum = await chickenContract.methods.currentRound().call();
                
                if (currentRoundNum <= 1) {
                    winnersListEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">No previous rounds yet</div>';
                    return;
                }

                // Get only the last settled round (not last 3)
                const allPlayersData = [];
                const roundsToCheck = Math.min(1, parseInt(currentRoundNum) - 1); // Only check 1 round
                
                for (let i = 0; i < roundsToCheck; i++) {
                    const roundNum = parseInt(currentRoundNum) - 1 - i;
                    if (roundNum < 1) break;
                    
                    try {
                        const roundInfo = await chickenContract.methods.getRoundInfo(roundNum).call();
                        
                        if (roundInfo.settled) {
                            const participants = await chickenContract.methods.getParticipants(roundNum).call();
                            const lottoWinner = roundInfo.lottoWinner;
                            const lottoPrize = parseFloat(web3.utils.fromWei(roundInfo.lottoPrize || '0', 'ether'));
                            const seedAmount = parseFloat(web3.utils.fromWei(roundInfo.seed || '0', 'ether'));
                            const loser = roundInfo.loser;
                            const wasHotzone = roundInfo.hzBonus && roundInfo.hzBonus !== '0';
                            
                            console.log('Previous round info:', {
                                round: roundNum,
                                loser: loser,
                                seedAmount: seedAmount,
                                lottoPrize: lottoPrize,
                                lottoWinner: lottoWinner,
                                wasHotzone: wasHotzone,
                                hzBonus: roundInfo.hzBonus,
                                mainPool: roundInfo.mainPool
                            });
                            
                            // NEW TAX STRUCTURE:
                            // ALL participants: 5% burn + 1% owner + 5% lotto = 11% tax on their deposit
                            // Chicken holder ONLY: additional 10% hotzone tax on their deposit at round end
                            // So winners get 89% of their deposit back
                            // Chicken's deposit: 11% tax to all, then 10% HZ tax if hotzone (so 79% goes to winners if HZ, 89% if not)
                            const allParticipantsTaxRate = 0.11; // 5% burn + 1% owner + 5% lotto = 11%
                            const winnerReturnRate = 0.89; // Winners get 89% of their deposit back (after 11% tax)
                            const chickenToWinnersRate = wasHotzone ? 0.79 : 0.89; // Chicken's deposit after taxes goes to winners
                            
                            // Get all deposits to calculate shares
                            let loserDeposit = 0;
                            let totalWinnerDeposits = 0;
                            const playerDeposits = {};
                            
                            for (const addr of participants) {
                                const deposit = await chickenContract.methods.deposits(roundNum, addr).call();
                                const depositEshare = parseFloat(web3.utils.fromWei(deposit, 'ether'));
                                playerDeposits[addr.toLowerCase()] = depositEshare;
                                console.log('Player deposit:', addr, depositEshare);
                                
                                if (addr.toLowerCase() === loser.toLowerCase()) {
                                    loserDeposit = depositEshare;
                                } else {
                                    totalWinnerDeposits += depositEshare;
                                }
                            }
                            
                            console.log('Loser deposit:', loserDeposit, 'Total winner deposits:', totalWinnerDeposits);
                            
                            // Amount from chicken going to winners pool (after chicken's taxes)
                            const chickenContribution = loserDeposit * chickenToWinnersRate;
                            console.log('Chicken contribution to winners:', chickenContribution, '(rate:', chickenToWinnersRate, ')');
                            
                            // Calculate each player's payout
                            for (const addr of participants) {
                                const depositEshare = playerDeposits[addr.toLowerCase()];
                                const isLoser = addr.toLowerCase() === loser.toLowerCase();
                                const isLottoWinner = addr.toLowerCase() === lottoWinner.toLowerCase();
                                
                                let payout = 0;
                                
                                if (isLoser) {
                                    // Loser gets seed as consolation (0% tax on seed)
                                    payout = seedAmount;
                                } else {
                                    // Winner gets:
                                    // 1. Their deposit back minus 11% tax (5% burn + 1% owner + 5% lotto)
                                    payout = depositEshare * winnerReturnRate;
                                    
                                    // 2. Their share of the chicken contribution (proportional to their deposit)
                                    if (totalWinnerDeposits > 0) {
                                        const shareOfChicken = (depositEshare / totalWinnerDeposits) * chickenContribution;
                                        payout += shareOfChicken;
                                    }
                                }
                                
                                // Add lotto prize if lotto winner
                                if (isLottoWinner) {
                                    payout += lottoPrize;
                                }
                                
                                const roi = payout - depositEshare;
                                
                                console.log('Player ROI calc:', {
                                    addr: addr,
                                    deposit: depositEshare,
                                    isLoser: isLoser,
                                    isLottoWinner: isLottoWinner,
                                    payout: payout,
                                    roi: roi
                                });
                                
                                allPlayersData.push({
                                    round: roundNum,
                                    address: addr,
                                    deposit: depositEshare,
                                    payout: payout,
                                    roi: roi,
                                    isLottoWinner: isLottoWinner,
                                    isLoser: isLoser
                                });
                            }
                        }
                    } catch (e) {
                        console.log('Error loading round', roundNum, e);
                    }
                }
                
                if (allPlayersData.length === 0) {
                    winnersListEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">No previous rounds yet</div>';
                    return;
                }
                
                // Sort: lotto winners first, then by ROI descending
                allPlayersData.sort((a, b) => {
                    // Lotto winners always on top
                    if (a.isLottoWinner && !b.isLottoWinner) return -1;
                    if (!a.isLottoWinner && b.isLottoWinner) return 1;
                    // Then sort by ROI descending (best ROI first)
                    return b.roi - a.roi;
                });
                
                // Display all players
                winnersListEl.innerHTML = allPlayersData.map(p => {
                    const lottoClass = p.isLottoWinner ? ' lotto-winner' : '';
                    const roiColor = p.roi >= 0 ? '#2ECC71' : '#E74C3C'; // Green for profit, red for loss
                    const roiSign = p.roi >= 0 ? '+' : '';
                    
                    let html = `
                        <div class="winner-item${lottoClass}">
                            <div class="winner-info">
                                <span class="winner-round">R${p.round}</span>
                                <span class="winner-address">${formatAddress(p.address)}</span>
                                ${p.isLottoWinner ? '<span class="lotto-badge"> LOTTO</span>' : ''}
                            </div>
                            <div class="winner-amount" style="color: ${roiColor};">
                                ${roiSign}${p.roi.toFixed(4)} <img src="eshare-logo.png" class="eshare-symbol" alt="E">
                            </div>
                        </div>
                    `;
                    
                    return html;
                }).join('');
                
            } catch (error) {
                console.error('Error loading previous winners:', error);
                winnersListEl.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">Error loading winners</div>';
            }
        }

        function checkScrollIndicator() {
            const container = previousHoldersEl;
            const indicator = document.getElementById('scrollIndicator');
            
            if (!indicator) return; // Exit if indicator doesn't exist yet
            
            // Show indicator if content is scrollable and user hasn't scrolled
            if (container.scrollHeight > container.clientHeight) {
                indicator.classList.add('show');
                
                // Hide indicator when user scrolls
                container.addEventListener('scroll', function() {
                    if (container.scrollTop > 10) {
                        indicator.classList.remove('show');
                    } else {
                        indicator.classList.add('show');
                    }
                });
            }
        }

        function formatAddress(address) {
            if (!address || address === '0x0000000000000000000000000000000000000000') {
                return '0x0000...0000';
            }
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }
    </script>

    <!-- Web3.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>

</body>
</html>